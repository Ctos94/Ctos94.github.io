import{_ as t,r as e,o as a,e as l,w as r,b as s,h as n,a as i,t as o,c as d,F as u,l as m,m as h,A as c,n as f}from"./index-a8be1886.js";/* empty css                  *//* empty css                 *//* empty css                  */import{P as p}from"./PriceFormat-af935241.js";import{_ as y}from"./Chart-7ca05392.js";import{f as b}from"./common-5afeacdf.js";const v={class:"d-flex"},g={class:"ml-2"},_={class:"d-flex mt-4"},k={class:"ml-2"};const w={class:"d-flex justify-space-between"},$={class:"text-overflow pr-8"},x={class:"font-12 text-grey"};const q={class:"d-flex justify-space-between"};const P=t({components:{OverView:t({components:{PriceFormat:p},props:{data:{type:Object}},data:()=>({date:void 0}),computed:{date_:{get(){return this.date||new Date(this.data.year,this.data.month-1)},set(t){this.$emit("dateChange",t.getFullYear(),t.getMonth()+1),this.date=t}}}},[["render",function(t,c,f,p,y,b){const w=e("PriceFormat"),$=h,x=e("v-icon"),q=e("v-card-text"),P=e("v-card"),F=e("v-sheet");return a(),l(F,{border:"",rounded:""},{default:r((()=>[s(P,{flat:""},{default:r((()=>[s(q,null,{default:r((()=>[n("div",v,[n("div",null,[i(" 总支出 "),s(w,{class:"font-weight-black",size:24,amount:f.data.priceTotal},null,8,["amount"])]),n("div",g,[i(o(f.data.year)+"年总支出 ",1),s(w,{class:"font-weight-black",size:24,amount:f.data.yearPriceTotal},null,8,["amount"])])]),n("div",_,[n("div",null,[s($,{modelValue:b.date_,"onUpdate:modelValue":c[0]||(c[0]=t=>b.date_=t),type:"month",placeholder:"选择月",clearable:!1,format:"YYYY年M月",class:"date-picker"},null,8,["modelValue"])]),n("div",k,[i(" 支出共计"+o(f.data.monthCount)+"笔，合计 ",1),s(w,{class:"font-weight-black mr-2",size:24,amount:f.data.monthPrice},null,8,["amount"]),f.data.compare?(a(),d(u,{key:0},[i(" 相较"+o(1==f.data.month?12:f.data.month-1)+"月 ",1),s(x,{style:{margin:"0 -10px 0 -10px","font-size":"30px"},color:f.data.compare>0?"red-darken-1":"green-darken-1",icon:f.data.compare>0?"mdi-triangle-small-up":"mdi-triangle-small-down"},null,8,["color","icon"]),i(" "+o(f.data.compare)+"% ",1)],64)):m("",!0)])])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-65cb857b"]]),ChartLine:t({components:{Chart:y,PriceFormat:p},props:{year:{type:Number,default:0},month:{type:Number,default:0}},computed:{changeData(){const{year:t,month:e}=this;return{year:t,month:e}}},data:()=>({visible:!1,bills:[],tableTitle:"",tableLoading:!1}),mounted(){this.$refs.chart.chart.on("click",(t=>{if(t)if(0===Number(t.value))this.$message.error("当日没有消费产生");else{let e=`${this.year}-${this.month<10?0+String(this.month):this.month}-${t.name<10?0+String(t.name):t.name}`;this.tableTitle=`${e}支出`,this.bills=[],this.tableLoading=!0,this.$request.get({url:c.bill.list.by_date,params:{date:e}}).then((t=>{this.bills=t})).finally((()=>{this.tableLoading=!1})),this.visible=!0}}))},methods:{request:function(){if(!this.year||!this.month)return;let t=[],e=[];this.$request.get({url:c.bill.dashboard.compared,params:{year:this.year,month:this.month},loading:{target:"#bill_line"}}).then((a=>{a.forEach((a=>{t.push(a.unit),e.push(a.price)}))})).finally((()=>{this.$refs.chart.chart.setOption({tooltip:{trigger:"axis",formatter:function(t,e,a){return`${t[0].axisValue}日: ${b(t[0].data)}`}},xAxis:{type:"category",data:t},yAxis:{type:"value"},series:[{data:e,type:"line",markLine:{silent:!0,lineStyle:{color:"rgba(193, 65, 65, 1)"},data:[{type:"average"}]}}]})}))}},watch:{changeData(t){this.request()}}},[["render",function(t,n,i,o,d,u){const m=y,h=e("v-card-text"),c=e("v-card"),f=e("PriceFormat"),p=e("v-data-table-virtual"),b=e("v-dialog"),v=e("v-sheet");return a(),l(v,{id:"bill_line",border:"",rounded:""},{default:r((()=>[s(c,{flat:"",title:i.year&&i.month?`${i.year}年${i.month}月支出对比`:"月支出对比"},{default:r((()=>[s(h,null,{default:r((()=>[s(m,{ref:"chart"},null,512)])),_:1})])),_:1},8,["title"]),s(b,{modelValue:d.visible,"onUpdate:modelValue":n[0]||(n[0]=t=>d.visible=t),width:"80%"},{default:r((()=>[s(c,{title:d.tableTitle},{default:r((()=>[s(h,null,{default:r((()=>[s(p,{loading:d.tableLoading,headers:[{title:"交易方",key:"payee",width:280,sortable:!1},{title:"支出项",key:"detail",sortable:!1},{title:"金额",key:"price",width:100,sortable:!1}],items:d.bills},{"item.price":r((({item:t})=>[s(f,{amount:t.price},null,8,["amount"])])),_:1},8,["loading","items"])])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])])),_:1})}]]),Rank:t({components:{PriceFormat:p},props:{year:{type:Number,default:0},month:{type:Number,default:0}},data:()=>({rank:[]}),computed:{changeData(){const{year:t,month:e}=this;return{year:t,month:e}}},methods:{request:function(){this.year&&this.month&&this.$request.get({url:c.bill.dashboard.rank,params:{year:this.year,month:this.month},loading:{target:"#rank"}}).then((t=>{this.rank=t}))}},watch:{changeData(t){this.request()}}},[["render",function(t,i,m,h,c,p){const y=e("PriceFormat"),b=e("v-list-item"),v=e("v-list"),g=e("v-card-text"),_=e("v-card"),k=e("v-sheet");return a(),l(k,{id:"rank",border:"",rounded:""},{default:r((()=>[s(_,{flat:"",title:m.year&&m.month?`${m.year}年${m.month}月支出排行`:"月支出排行"},{default:r((()=>[s(g,null,{default:r((()=>[s(v,{class:"pa-0"},{default:r((()=>[(a(!0),d(u,null,f(c.rank,(t=>(a(),l(b,{class:"pa-0",key:t.id},{default:r((()=>[n("div",w,[n("span",$,o(t.detail),1),s(y,{amount:t.price},null,8,["amount"])]),n("div",x,o(t.date),1)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["title"])])),_:1})}]]),Classify:t({components:{PriceFormat:p},props:{year:{type:Number,default:0},month:{type:Number,default:0}},data:()=>({classifies:[]}),computed:{changeData(){const{year:t,month:e}=this;return{year:t,month:e}}},methods:{request:function(){this.year&&this.month&&this.$request.get({url:c.bill.dashboard.classify,params:{year:this.year,month:this.month},loading:{target:"#classify"}}).then((t=>{this.classifies=t}))}},watch:{changeData(t){this.request()}}},[["render",function(t,i,h,c,p,y){const b=e("PriceFormat"),v=e("v-progress-linear"),g=e("v-list-item"),_=e("v-list"),k=e("v-card-text"),w=e("v-card"),$=e("v-sheet");return a(),l($,{id:"classify",border:"",rounded:""},{default:r((()=>[s(w,{flat:"",title:h.year&&h.month?`${h.year}年${h.month}月支出分类`:"月支出分类"},{default:r((()=>[p.classifies.length?(a(),l(k,{key:0},{default:r((()=>[s(_,{class:"pa-0"},{default:r((()=>[(a(!0),d(u,null,f(p.classifies,((t,e)=>(a(),l(g,{class:"pa-0",key:e},{default:r((()=>[n("div",q,[n("div",null,o(t.tag)+o(t.percentage)+"%",1),s(b,{amount:t.price},null,8,["amount"])]),s(v,{color:"blue-lighten-1","model-value":t.percentage},null,8,["model-value"])])),_:2},1024)))),128))])),_:1})])),_:1})):m("",!0)])),_:1},8,["title"])])),_:1})}]])},data:()=>({data:{year:null,month:null}}),beforeMount(){this.$store.commit("update_sider_active","/bill/dashboard")},mounted(){this.fRequest()},methods:{fRequest:function(t,e){this.$request.get({url:c.bill.dashboard.overview,params:{year:t,month:e},loading:{target:"#overview"}}).then((t=>{this.data=t}))}}},[["render",function(t,n,i,o,d,u){const m=e("OverView"),h=e("ChartLine"),c=e("v-col"),f=e("Classify"),p=e("Rank"),y=e("v-row"),b=e("v-sheet");return a(),l(b,null,{default:r((()=>[s(y,null,{default:r((()=>[s(c,{cols:"8",class:"pr-0"},{default:r((()=>[s(m,{id:"overview",class:"mb-2",data:d.data,onDateChange:u.fRequest},null,8,["data","onDateChange"]),s(h,{year:d.data.year,month:d.data.month},null,8,["year","month"])])),_:1}),s(c,{cols:"4"},{default:r((()=>[s(f,{class:"mb-2",year:d.data.year,month:d.data.month},null,8,["year","month"]),s(p,{year:d.data.year,month:d.data.month},null,8,["year","month"])])),_:1})])),_:1})])),_:1})}]]);export{P as default};
