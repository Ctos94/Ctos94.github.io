import{C as e,L as l,r as t,o as i,c as a,b as s,w as o,f as d,F as n,I as r,A as u,_ as c,e as m,a as h,t as v,l as p}from"./index-e40139dd.js";const f=c({components:{RoleDialog:{__name:"RoleDialog",emits:["submited"],setup(c,{expose:m,emit:h}){const v=e(!1),p=e(!1),f=e({}),g=e(null),y=h,b=async()=>{const{valid:e}=await g.value.validate();e&&(v.value=!0,r.execute({method:f.value.id?"put":"post",url:f.value.id?u.system.role.update:u.system.role.create,data:f.value,json:!0}).then((()=>{p.value=!1,y("submited")})).finally((()=>{v.value=!1})))};return l(p,((e,l)=>{e||(g.value.reset(),f.value={})})),m({edit:e=>{f.value={...e},p.value=!0}}),(e,l)=>{const r=t("v-btn"),u=t("v-text-field"),c=t("v-card-text"),m=t("v-spacer"),h=t("v-btn-text"),y=t("v-card-actions"),_=t("v-card"),k=t("v-form"),x=t("v-dialog");return i(),a(n,null,[s(r,{color:"blue-lighten-1",text:"新增角色",onClick:l[0]||(l[0]=e=>p.value=!0)}),s(x,{modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=e=>p.value=e),"max-width":"350"},{default:o((()=>[s(k,{onSubmit:l[4]||(l[4]=d((()=>{}),["prevent"])),ref_key:"formRef",ref:g},{default:o((()=>[s(_,null,{default:o((()=>[s(c,null,{default:o((()=>[s(u,{rules:[e.$validator.required],label:"角色名称",modelValue:f.value.name,"onUpdate:modelValue":l[1]||(l[1]=e=>f.value.name=e)},null,8,["rules","modelValue"]),s(u,{rules:[e.$validator.required,e.$validator.integer],label:"排序号",modelValue:f.value.sort,"onUpdate:modelValue":l[2]||(l[2]=e=>f.value.sort=e)},null,8,["rules","modelValue"])])),_:1}),s(y,null,{default:o((()=>[s(m),s(h,{text:"取消",onClick:l[3]||(l[3]=e=>p.value=!1)}),s(h,{disabled:v.value,loading:v.value,color:"primary",text:"保存",onClick:b},null,8,["disabled","loading"])])),_:1})])),_:1})])),_:1},512)])),_:1},8,["modelValue"])],64)}}},UserMenusDialog:c({data:()=>({role_id:"",visible:!1,menus:[],selected:[],loading:!1,deep_check:!1}),methods:{init(){this.loading=!0;const e=new Promise(((e,l)=>{this.$request.get({url:u.system.menu.permissions_tree}).then((l=>{e(l)}))})).then((e=>{this.menus=e})),l=new Promise(((e,l)=>{this.$request.get({url:u.system.role.authorization_ids,params:{roleId:this.role_id}}).then((l=>{e(l)}))})).then((e=>{this.selected=e}));Promise.all([e,l]).finally((()=>{this.loading=!1}))},show:function(e){this.role_id=e,this.visible=!0,this.$nextTick((()=>{this.init()}))},isSelected(e){return-1!=this.selected.map((e=>e.id)).indexOf(e)},toggleSelect(e){const l=(e,t)=>{let i=this.selected.map((e=>e.id));void 0===t&&(t=-1===i.indexOf(e.id));let a=i.indexOf(e.id);-1===a&&t?this.selected.push({id:e.id,type:e.classify}):t||this.selected.splice(a,1),e.children&&e.children.length>0&&this.deep_check&&e.children.forEach((e=>{l(e,t)}))};l(e)},save:function(){this.loading=!0,this.$request.post({url:u.system.role.update_authorization,data:{roleId:this.role_id,authorization:this.selected},json:!0}).then((()=>{this.$message.success("保存成功")})).finally((()=>{this.loading=!1}))}},watch:{visible(e){e||(this.selected=[],this.menus=[],this.deep_check=!1)}}},[["render",function(e,l,r,u,c,f){const g=t("v-progress-circular"),y=t("v-overlay"),b=t("v-checkbox"),_=t("v-treeview"),k=t("v-card-text"),x=t("v-switch"),V=t("v-sheet"),C=t("v-btn-text"),w=t("v-card"),$=t("v-dialog");return i(),m($,{modelValue:c.visible,"onUpdate:modelValue":l[5]||(l[5]=e=>c.visible=e),width:"600",scrollable:""},{default:o((()=>[s(w,null,{actions:o((()=>[s(V,{width:"100%",class:"d-flex justify-space-between pl-5"},{default:o((()=>[s(V,null,{default:o((()=>[s(x,{density:"compact","hide-details":"",modelValue:c.deep_check,"onUpdate:modelValue":l[2]||(l[2]=e=>c.deep_check=e),color:"primary",label:"父子节点关联"},null,8,["modelValue"])])),_:1}),s(V,null,{default:o((()=>[s(C,{onClick:l[3]||(l[3]=e=>c.visible=!1),text:"关闭"}),s(C,{color:"primary",onClick:l[4]||(l[4]=e=>f.save()),text:"确定"})])),_:1})])),_:1})])),default:o((()=>[s(y,{contained:"",modelValue:c.loading,"onUpdate:modelValue":l[0]||(l[0]=e=>c.loading=e),class:"align-center justify-center"},{default:o((()=>[s(g,{color:"primary",indeterminate:""})])),_:1},8,["modelValue"]),s(k,null,{default:o((()=>[s(_,{density:"compact",items:c.menus,"active-strategy":"classic"},{prepend:o((({item:e})=>[s(b,{density:"compact",onClick:l[1]||(l[1]=d((()=>{}),["stop"])),ripple:!1,"onUpdate:modelValue":l=>f.toggleSelect(e),"model-value":f.isSelected(e.id),"hide-details":!0},null,8,["onUpdate:modelValue","model-value"])])),title:o((({item:e})=>[h(v(e.title||e.name)+" ",1),"PAGE"===e.classify?(i(),a(n,{key:0},[h("[页面]")],64)):p("",!0),"PERMISSION"===e.classify?(i(),a(n,{key:1},[h("[权限]")],64)):p("",!0)])),_:1},8,["items"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}]])},data:()=>({loading:!1,tableHeaders:[{title:"排序号",key:"sort",width:90,sortable:!1},{title:"角色",key:"name",sortable:!1},{title:"用户数",key:"userCount",width:100,align:"center",sortable:!1},{key:"actions",width:500,align:"center",sortable:!1}],roles:[]}),beforeMount(){this.$store.commit("update_sider_active","/system/roles")},mounted(){this.requestRoles()},methods:{requestRoles(){this.loading=!0,this.$request.get({url:u.system.role.all}).then((e=>{this.roles=e})).finally((()=>{this.loading=!1}))},del(e){this.$confirm({message:"是否要删除？",beforeClose:(l,t,i)=>{"confirm"===l?this.$request.delete({url:u.system.role.delete,data:{id:e}}).then((()=>{i()})):i()}}).then((()=>{this.requestRoles()})).catch((()=>{}))}}},[["render",function(e,l,d,r,u,c){const m=t("RoleDialog"),h=t("UserMenusDialog"),v=t("v-btn-link"),p=t("v-data-table-virtual");return i(),a(n,null,[s(m,{ref:"RoleDialog",onSubmited:c.requestRoles},null,8,["onSubmited"]),s(h,{ref:"UserMenusDialog"},null,512),s(p,{loading:u.loading,headers:u.tableHeaders,items:u.roles},{"item.actions":o((({item:l})=>[s(v,{text:"编辑",onClick:t=>e.$refs.RoleDialog.edit(l)},null,8,["onClick"]),s(v,{onClick:()=>{e.$router.push({path:"/system/role/users",query:{id:l.id}})},text:"关联用户"},null,8,["onClick"]),s(v,{onClick:t=>e.$refs.UserMenusDialog.show(l.id),text:"关联菜单 & 权限"},null,8,["onClick"]),s(v,{onClick:e=>c.del(l.id),text:"删除"},null,8,["onClick"])])),_:1},8,["loading","headers","items"])],64)}]]);export{f as default};
