import{_ as e,o as s,a as i,d as t,I as a,p as l,G as r,P as o,i as d,A as u,h as c,w as f,F as n,Q as h,R as p,r as m,S as g,T as _,b as x,s as y,e as A,t as I,E as k,U as w,V as v}from"./index-34813d37.js";/* empty css                 *//* empty css               */import{_ as V}from"./Uploader-27ceeafa.js";const b={key:0,class:"mask"};const S=e({props:{src:{type:String},height:{type:String,default:"100%"}},computed:{showMask(){return this.$slots.mask}}},[["render",function(e,d,u,c,f,n){const h=o;return s(),i("div",{class:"container",style:r({height:u.height})},[t(h,{src:u.src},null,8,["src"]),n.showMask?(s(),i("div",b,[a(e.$slots,"mask",{},void 0,!0)])):l("",!0)],4)}],["__scopeId","data-v-7ddf7ef8"]]),q={class:"header"},L=["onClick"],U={key:0,class:"picture-box"},$={class:"picture-dialog"},F={class:"picture-box"},j={class:"btn"};const C=e({setup(){d().commit("update_sider_openeds","DIABLO4_SOURCE_AFFIXES")},components:{Uploader:V},data:()=>({uploaded_count:0,queryArgs:{keyword:"",notHasImages:void 0},showImage:!1,upload_url:u.diablo4.source.import_data,upload_file_url:u.file.upload,affixList:[],filterAffixList:[],picVisible:!1,picList:[],current_affix:void 0}),computed:{dialogTitle:function(){return null!=this.current_affix?this.current_affix.description:""}},mounted(){this.fetchAffixes()},methods:{fetchAffixes(){this.$request.get({url:u.diablo4.source.affixes,params:{showImage:this.showImage}}).then((e=>{this.affixList=e,this.$nextTick((()=>{this.filterAffix()}))}))},filterAffix(){this.filterAffixList=this.affixList.filter((e=>{let s=!0,i=!0;return this.queryArgs.keyword&&(s=e.description.includes(this.queryArgs.keyword)),this.queryArgs.notHasImages&&(i=!e.hasImages),s&&i}))},showPicDialog(e){this.picVisible=!0,this.current_affix=e,this.fetchAffixImages()},fetchAffixImages(){this.$request.get({url:u.diablo4.source.affix_images,params:{idSno:this.current_affix.idSno}}).then((e=>{this.picList=e,null!=this.current_affix&&(this.current_affix.hasImages=this.picList.length>0,this.showImage&&(this.current_affix.images=this.picList))}))},saveAffixImages(e,s,i){if(this.uploaded_count++,this.uploaded_count==i.length){let e=[];i.forEach((s=>{e.push(s.response.data.id)})),this.$request.post({url:u.diablo4.source.save_affix_images,data:{idSno:this.current_affix.idSno,fileIds:e.join(",")}}).then((()=>{this.uploaded_count=0,this.$refs.uploader.clearFiles(),this.fetchAffixImages()}))}},delPic(e){this.$request.delete({loading:{fullscreen:!0,lock:!0},url:u.diablo4.source.del_affix_image,data:{id:e}}).then((()=>{this.fetchAffixImages()}))}},watch:{queryArgs:{handler:"filterAffix",deep:!0},showImage:{handler:"fetchAffixes"}}},[["render",function(e,a,r,o,d,u){const b=h,C=p,O=V,E=m("WarnTriangleFilled"),P=k,R=S,T=w,D=g,H=m("Delete"),B=v,M=_;return s(),i(n,null,[c("div",q,[t(b,{clearable:"",style:{width:"300px",height:"32px",marginRight:"12px"},modelValue:d.queryArgs.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>d.queryArgs.keyword=e),placeholder:"词缀"},null,8,["modelValue"]),t(C,{modelValue:d.queryArgs.notHasImages,"onUpdate:modelValue":a[1]||(a[1]=e=>d.queryArgs.notHasImages=e),style:{marginRight:"12px"}},{default:f((()=>a[5]||(a[5]=[x("未关联图像")]))),_:1},8,["modelValue"]),t(C,{modelValue:d.showImage,"onUpdate:modelValue":a[2]||(a[2]=e=>d.showImage=e),style:{marginRight:"12px"}},{default:f((()=>a[6]||(a[6]=[x("显示图像")]))),_:1},8,["modelValue"]),t(O,{upload_url:d.upload_url,accept:".json",data:{type:"AFFIXES"},onOnSuccess:u.fetchAffixes},null,8,["upload_url","onOnSuccess"])]),t(D,{gutter:20},{default:f((()=>[(s(!0),i(n,null,y(d.filterAffixList,(e=>(s(),A(T,{key:e.idSno,span:8,class:"pointer",style:{marginBottom:"8px"}},{default:f((()=>[c("div",{class:"grid-content",onClick:s=>u.showPicDialog(e)},[e.hasImages?l("",!0):(s(),A(P,{key:0,class:"text-red"},{default:f((()=>[t(E)])),_:1})),c("span",null,I(e.description),1)],8,L),this.showImage?(s(),i("div",U,[(s(!0),i(n,null,y(e.images,(e=>(s(),i("div",{class:"pic",key:e.id},[t(R,{height:"40px",src:e.fileUrl},null,8,["src"])])))),128))])):l("",!0)])),_:2},1024)))),128))])),_:1}),c("div",$,[t(M,{modelValue:d.picVisible,"onUpdate:modelValue":a[3]||(a[3]=e=>d.picVisible=e),"z-index":2,width:"500",onClosed:a[4]||(a[4]=e=>this.current_affix=void 0),title:u.dialogTitle},{default:f((()=>[c("div",F,[(s(!0),i(n,null,y(d.picList,(e=>(s(),i("div",{class:"pic",key:e.id},[t(R,{height:"40px",src:e.fileUrl},{mask:f((()=>[t(P,{onClick:s=>u.delPic(e.id),class:"mask-icon"},{default:f((()=>[t(H)])),_:2},1032,["onClick"])])),_:2},1032,["src"])])))),128))]),c("div",j,[t(O,{ref:"uploader",upload_url:d.upload_file_url,accept:"image/*",multiple:!0,onOnSuccess:u.saveAffixImages},{default:f((()=>[t(B,{type:"primary"},{default:f((()=>a[7]||(a[7]=[x("Upload")]))),_:1})])),_:1},8,["upload_url","onOnSuccess"])])])),_:1},8,["modelValue","title"])])],64)}],["__scopeId","data-v-af8273b9"]]);export{C as default};
