import{_ as e,A as t,r as l,o as i,c as a,b as s,w as o,f as d,e as n,s as r,F as m,a as u,t as c,G as h,h as p,z as f,K as y,L as v,u as b,k as w,j as k,q as g,l as x}from"./index-985ef963.js";import{_ as V}from"./TreeSelect-541ea714.js";const _=e({components:{TreeSelect:V},props:{parents:{type:Array,default:function(){return[]}}},emits:["submited"],data:()=>({visible:!1,submit_loading:!1,form:{}}),computed:{parents$:{get(){return function e(t){return t.reduce(((t,l)=>("PAGE"!=l.type&&(l.children&&l.children.length>0&&(l.children=e(l.children)),t.push(l)),t)),[])}(JSON.parse(JSON.stringify(this.parents)))}},parentId$:{get(){return this.form.parentId},set(e){this.form.parentId=e||null}}},methods:{edit(e){this.form={...e},this.visible=!0},async submit(){const{valid:e}=await this.$refs.form.validate();e&&(this.submit_loading=!0,this.$request.execute({method:this.form.id?"put":"post",url:this.form.id?t.system.menu.update:t.system.menu.create,data:this.form,json:!0}).then((()=>{this.visible=!1,this.$emit("submited")})).finally((()=>{this.submit_loading=!1})))}},watch:{visible(e){e||(this.$refs.form.reset(),this.form={})}}},[["render",function(e,t,u,c,h,p){const f=l("v-btn"),y=l("v-text-field"),v=l("v-col"),b=l("v-row"),w=l("v-select"),k=V,g=l("v-card-text"),x=l("v-spacer"),_=l("v-btn-text"),$=l("v-card-actions"),C=l("v-card"),I=l("v-form"),q=l("v-dialog");return i(),a(m,null,[s(f,{onClick:t[0]||(t[0]=e=>h.visible=!0),color:"blue-lighten-1",text:"添加菜单"}),s(q,{modelValue:h.visible,"onUpdate:modelValue":t[10]||(t[10]=e=>h.visible=e),"max-width":"600"},{default:o((()=>[s(I,{onSubmit:t[9]||(t[9]=d((()=>{}),["prevent"])),ref:"form"},{default:o((()=>[s(C,null,{default:o((()=>[s(g,null,{default:o((()=>[s(b,{class:"mt-0"},{default:o((()=>[s(v,null,{default:o((()=>[s(y,{label:"名称",rules:[e.$validator.required],modelValue:h.form.title,"onUpdate:modelValue":t[1]||(t[1]=e=>h.form.title=e)},null,8,["rules","modelValue"])])),_:1}),s(v,null,{default:o((()=>[s(y,{rules:[e.$validator.required,e.$validator.integer],label:"排序号",modelValue:h.form.sort,"onUpdate:modelValue":t[2]||(t[2]=e=>h.form.sort=e)},null,8,["rules","modelValue"])])),_:1})])),_:1}),s(b,{class:"mt-0"},{default:o((()=>[s(v,null,{default:o((()=>[s(w,{rules:[e.$validator.required],items:[{title:"菜单",value:"MENU"},{title:"页面",value:"PAGE"}],modelValue:h.form.type,"onUpdate:modelValue":t[3]||(t[3]=e=>h.form.type=e),label:"类型"},null,8,["rules","modelValue"])])),_:1}),s(v,null,{default:o((()=>[s(y,{label:"module",modelValue:h.form.module,"onUpdate:modelValue":t[4]||(t[4]=e=>h.form.module=e)},null,8,["modelValue"])])),_:1})])),_:1}),h.form.id?r("",!0):(i(),n(k,{key:0,itemTitle:"title",itemValue:"id",label:"上级菜单",items:p.parents$,modelValue:p.parentId$,"onUpdate:modelValue":t[5]||(t[5]=e=>p.parentId$=e)},null,8,["items","modelValue"])),s(y,{rules:[e.$validator.required],label:"代码",modelValue:h.form.code,"onUpdate:modelValue":t[6]||(t[6]=e=>h.form.code=e)},null,8,["rules","modelValue"]),s(y,{label:"路径",modelValue:h.form.path,"onUpdate:modelValue":t[7]||(t[7]=e=>h.form.path=e)},null,8,["modelValue"])])),_:1}),s($,null,{default:o((()=>[s(x),s(_,{text:"取消",onClick:t[8]||(t[8]=e=>h.visible=!1)}),s(_,{disabled:h.submit_loading,loading:h.submit_loading,color:"primary",text:"保存",onClick:p.submit},null,8,["disabled","loading","onClick"])])),_:1})])),_:1})])),_:1},512)])),_:1},8,["modelValue"])],64)}]]),$={id:null,name:null,code:null},C={rowType:"modify"},I={rowType:"add"},q={style:{float:"left"}},T={class:"code-select-span ml-4"};const D=e({data:()=>({headers:[{key:"name",width:"200",title:"名称",sortable:!1},{key:"code",title:"权限代码",sortable:!1},{key:"actions",width:"160",sortable:!1}],menuId:null,visible:!1,showAddRow:!0,modifyRowIdx:-1,dataList:[],formData:{modify:null,add:JSON.parse(JSON.stringify($))},authorityCodes:[]}),computed:{dataListView(){let e=[...this.dataList];return this.showAddRow&&e.push(I),-1!==this.modifyRowIdx&&(e[this.modifyRowIdx]=C),e}},methods:{show(e){this.menuId=e,this.visible=!0,this.$nextTick((()=>{this.requestAuthorityCodes(),this.requestPermissions()}))},async requestAuthorityCodes(){await this.$request.get({url:t.system.permission.codes}).then((e=>{this.authorityCodes=Object.keys(e).map((t=>({code:t,label:e[t]})))}))},async requestPermissions(){await this.$request.get({url:t.system.menu.permissions,params:{menuId:this.menuId},loading:{target:"#permission"}}).then((e=>{this.dataList=e}))},resetAddRow(){this.formData.add=JSON.parse(JSON.stringify($))},async tableBtnClick(e,l,i){switch(e){case"add":var{valid:a}=await this.$refs.form.validate();if(!a)return;Object.assign(this.formData.add,{menuId:this.menuId}),this.$request.post({url:t.system.permission.create,data:this.formData.add,json:!0,loading:{target:"#permission"}}).then((()=>{this.resetAddRow(),this.requestPermissions()}));break;case"modify":-1!==this.modifyRowIdx?this.$message.error("请先完成修改的行"):(this.showAddRow=!1,this.formData.modify=JSON.parse(JSON.stringify(l)),this.modifyRowIdx=i);break;case"update":var{valid:a}=await this.$refs.form.validate();if(!a)return;this.$request.put({url:t.system.permission.update,data:{id:this.formData.modify.id,name:this.formData.modify.name,code:this.formData.modify.code},json:!0,loading:{target:"#permission"}}).then((()=>{this.requestPermissions(),this.showAddRow=!0,this.formData.modify=null,this.modifyRowIdx=-1}));break;case"cancel":this.showAddRow=!0,this.formData.modify=null,this.modifyRowIdx=-1;break;case"delete":this.$confirm({message:"是否删除？"}).then((()=>{this.$request.delete({url:t.system.permission.delete,data:{id:l.id},loading:{target:"#permission"}}).then((()=>{this.requestPermissions()}))})).catch((()=>{}))}}},watch:{visible(e){e||this.$refs.form.reset()}}},[["render",function(e,t,f,y,v,b){const w=l("v-text-field"),k=l("v-list-item"),g=l("v-select"),x=l("v-btn-link"),V=l("v-data-table-virtual"),_=l("v-form"),$=l("v-card-text"),C=l("v-card"),I=l("v-dialog");return i(),n(I,{modelValue:v.visible,"onUpdate:modelValue":t[4]||(t[4]=e=>v.visible=e),"max-width":"760px"},{default:o((()=>[s(C,{id:"permission"},{default:o((()=>[s($,null,{default:o((()=>[s(_,{ref:"form",onSubmit:t[3]||(t[3]=d((()=>{}),["prevent"]))},{default:o((()=>[s(V,{headers:v.headers,items:b.dataListView},{"item.name":o((({item:t})=>[t.rowType?(i(),n(w,{key:0,density:"compact",variant:"outlined","hide-details":"","validate-on":"submit",modelValue:v.formData[t.rowType].name,"onUpdate:modelValue":e=>v.formData[t.rowType].name=e,rules:[e.$validator.required]},null,8,["modelValue","onUpdate:modelValue","rules"])):(i(),a(m,{key:1},[u(c(t.name),1)],64))])),"item.code":o((({item:t})=>[t.rowType?(i(),n(g,{key:0,density:"compact",variant:"outlined","hide-details":"",clearable:"","validate-on":"submit",rules:[e.$validator.required],items:v.authorityCodes,"item-title":"code","item-value":"code",modelValue:v.formData[t.rowType].code,"onUpdate:modelValue":e=>v.formData[t.rowType].code=e},{item:o((({props:e,item:t})=>[s(k,h({ripple:!1},e),{title:o((()=>[p("span",q,c(t.raw.code),1),p("span",T,c(t.raw.label),1)])),_:2},1040)])),_:2},1032,["rules","items","modelValue","onUpdate:modelValue"])):(i(),a(m,{key:1},[u(c(t.code),1)],64))])),"item.actions":o((({item:e,index:l})=>["add"===e.rowType?(i(),n(x,{key:0,type:"success",onClick:t[0]||(t[0]=e=>b.tableBtnClick("add")),text:"添加"})):"modify"===e.rowType?(i(),a(m,{key:1},[s(x,{onClick:t[1]||(t[1]=e=>b.tableBtnClick("update")),text:"保存"}),s(x,{onClick:t[2]||(t[2]=e=>b.tableBtnClick("cancel")),text:"取消"})],64)):(i(),a(m,{key:2},[s(x,{onClick:d((t=>b.tableBtnClick("modify",e,l)),["stop"]),text:"修改"},null,8,["onClick"]),-1===this.modifyRowIdx?(i(),n(x,{key:0,size:"small",icon:"mdi-delete",onClick:d((t=>b.tableBtnClick("delete",e,l)),["stop"])},null,8,["onClick"])):r("",!0)],64))])),_:1},8,["headers","items"])])),_:1},512)])),_:1})])),_:1})])),_:1},8,["modelValue"])}]]),A={key:2,style:"margin-left: 36px"};const R=e({name:"TreeTableItem",props:{columns:{type:Array},item:{type:Object},loop:{type:Number,default:0}},computed:{columns_(){return this.columns.filter((e=>e.key))}},data:()=>({expand:!1})},[["render",function(e,t,s,u,h,b){const w=l("v-btn"),k=l("TreeTableItem",!0);return i(),a(m,null,[p("tr",null,[(i(!0),a(m,null,f(b.columns_,((e,l)=>(i(),a("td",{key:l,style:y({textAlign:e.align})},[0==l?(i(),a(m,{key:0},[s.loop&&s.loop>0?(i(),a("span",{key:0,style:y(`margin-left: ${15*s.loop}px`)},null,4)):r("",!0),s.item.children&&s.item.children.length>0?(i(),n(w,{key:1,class:"mr-2",density:"compact",onClick:t[0]||(t[0]=d((e=>h.expand=!h.expand),["stop"])),icon:h.expand?"mdi-menu-down":"mdi-menu-right"},null,8,["icon"])):(i(),a("span",A))],64)):r("",!0),p("span",null,c(e.render?e.render(s.item[e.key],s.item):s.item[e.key]),1)],4)))),128)),v(e.$slots,"item.actions",{row:s.item})]),s.item&&s.item.children&&s.item.children.length>0&&h.expand?(i(!0),a(m,{key:0},f(s.item.children,(t=>(i(),n(k,{key:t.id,loop:s.loop+1,item:t,columns:s.columns},{"item.actions":o((()=>[v(e.$slots,"item.actions",{row:t})])),_:2},1032,["loop","item","columns"])))),128)):r("",!0)],64)}]]),U={components:{TreeTableItem:R},props:{loading:{type:Boolean,default:!1},headers:{type:Array,defalut:()=>[]},items:{type:Array,defalut:()=>[]}},data:()=>({}),mounted(){},methods:{filter:e=>e.filter((e=>e.key))}},S={key:0,class:"data-table-actions",style:{width:"200px"}},N=[p("span",null,null,-1)];const O=e(U,[["render",function(e,t,d,n,u,h){const b=R,w=l("v-data-table-virtual");return i(),a("div",null,[s(w,{loading:d.loading,headers:[...d.headers,{}],items:d.items},{headers:o((({headers:t})=>[p("tr",null,[(i(!0),a(m,null,f(h.filter(t[0]),(e=>(i(),a("th",{key:e.key,style:y({width:`${e.width}px`})},[p("div",{class:"v-data-table-header__content",style:y({justifyContent:e.align})},[p("span",null,c(e.title),1)],4)],4)))),128)),e.$slots["item.actions"]?(i(),a("th",S,N)):r("",!0)])])),item:o((({item:t,columns:l})=>[s(b,{item:t,columns:l},{"item.actions":o((({row:t})=>[v(e.$slots,"item.actions",{row:t})])),_:2},1032,["item","columns"])])),_:3},8,["loading","headers","items"])])}]]),j={width:"200"},P={__name:"Menus",setup(e){const d=b(),n=w(!1),r=w([]),m=()=>{n.value=!0,x.get({url:t.system.menu.list}).then((e=>{r.value=e})).finally((()=>{n.value=!1}))};return k((()=>{d.commit("update_sider_active","/system/menus")})),g((()=>{m()})),(e,t)=>{const d=l("v-btn-link");return i(),a("div",null,[s(_,{ref:"menuDialog",onSubmited:m,parents:r.value},null,8,["parents"]),s(D,{ref:"menuPermissionDialog"},null,512),s(O,{headers:[{title:"标题",key:"title",width:180},{title:"module",key:"module",width:180},{title:"类型",key:"type",width:150,align:"center",render:(e,t)=>"MENU"===e?"菜单":"页面"},{title:"路径",key:"path"},{title:"代码",key:"code",width:300}],items:r.value,loading:n.value},{"item.actions":o((({row:t})=>[p("td",j,[s(d,{onClick:l=>e.$refs.menuDialog.edit(t),text:"编辑"},null,8,["onClick"]),s(d,{onClick:l=>e.$refs.menuPermissionDialog.show(t.id),text:"权限管理"},null,8,["onClick"])])])),_:1},8,["headers","items","loading"])])}}};export{P as default};
