import{_ as e,r as t,o as l,c as a,h as i,F as s,n as o,z as d,l as n,e as r,f as m,t as u,B as c,w as h,b as f,A as p,v as y,a as b}from"./index-b6422c35.js";import{_ as v}from"./TreeSelect-6548c070.js";const w={key:2,style:"margin-left: 21px"};const k=e({name:"TreeTableItem",props:{columns:{type:Array},item:{type:Object},loop:{type:Number,default:0}},computed:{columns_(){return this.columns.filter((e=>e.key))}},data:()=>({expand:!1})},[["render",function(e,f,p,y,b,v){const k=t("v-icon"),g=t("TreeTableItem",!0);return l(),a(s,null,[i("tr",null,[(l(!0),a(s,null,o(v.columns_,((e,t)=>(l(),a("td",{key:t,style:d({textAlign:e.align})},[0==t?(l(),a(s,{key:0},[p.loop&&p.loop>0?(l(),a("span",{key:0,style:d(`margin-left: ${15*p.loop}px`)},null,4)):n("",!0),p.item.children&&p.item.children.length>0?(l(),r(k,{key:1,onClick:f[0]||(f[0]=m((e=>b.expand=!b.expand),["stop"])),icon:b.expand?"mdi-menu-down":"mdi-menu-right"},null,8,["icon"])):(l(),a("span",w))],64)):n("",!0),i("span",null,u(e.render?e.render(p.item[e.key]):p.item[e.key]),1)],4)))),128)),c(e.$slots,"default")]),p.item&&p.item.children&&p.item.children.length>0&&b.expand?(l(!0),a(s,{key:0},o(p.item.children,((t,a)=>(l(),r(g,{key:a,loop:p.loop+1,item:t,columns:p.columns},{default:h((()=>[c(e.$slots,"default")])),_:2},1032,["loop","item","columns"])))),128)):n("",!0)],64)}]]),g={components:{TreeTableItem:k},props:{loading:{type:Boolean,default:!1},headers:{type:Array,defalut:()=>[]},items:{type:Array,defalut:()=>[]}},data:()=>({}),mounted(){},methods:{filter:e=>e.filter((e=>e.key))}},x={key:0,class:"data-table-actions",style:{width:"200px"}},_=[i("span",null,null,-1)];const V=e(g,[["render",function(e,r,m,p,y,b){const v=k,w=t("v-data-table-virtual");return l(),a("div",null,[f(w,{loading:m.loading,headers:[...m.headers,{}],items:m.items},{headers:h((({headers:t})=>[i("tr",null,[(l(!0),a(s,null,o(b.filter(t[0]),(e=>(l(),a("th",{key:e.key,style:d({width:`${e.width}px`})},[i("div",{class:"v-data-table-header__content",style:d({justifyContent:e.align})},[i("span",null,u(e.title),1)],4)],4)))),128)),e.$slots["item.actions"]?(l(),a("th",x,_)):n("",!0)])])),item:h((({item:t,columns:l})=>[f(v,{item:t,columns:l},{default:h((()=>[e.$slots["item.actions"]?c(e.$slots,"item.actions",{key:0,item:t}):n("",!0)])),_:2},1032,["item","columns"])])),_:3},8,["loading","headers","items"])])}]]);const $={id:null,name:null,code:null},C={rowType:"modify"},q={rowType:"add"},T={style:{float:"left"}},I={class:"code-select-span"};const D={width:"200"};const A=e({components:{MenuDialog:e({components:{TreeSelect:v},props:{parents:{type:Array,default:function(){return[]}}},emits:["submited"],data:()=>({visible:!1,submit_loading:!1,form:{}}),methods:{edit(e){this.form={...e},this.visible=!0},async submit(){const{valid:e}=await this.$refs.form.validate();e&&(this.submit_loading=!0,this.$request.execute({method:this.form.id?"put":"post",url:this.form.id?p.system.menu.update:p.system.menu.create,data:this.form,json:!0}).then((()=>{this.visible=!1,this.$emit("submited")})).finally((()=>{this.submit_loading=!1})))}},watch:{visible(e){e||this.$refs.form.reset()}}},[["render",function(e,a,i,s,o,d){const u=t("v-btn"),c=t("v-text-field"),p=t("v-col"),b=t("v-row"),w=t("v-select"),k=v,g=t("v-card-text"),x=t("v-spacer"),_=t("v-btn-text"),V=t("v-card-actions"),$=t("v-card"),C=t("v-form"),q=t("v-dialog");return l(),r(q,{modelValue:o.visible,"onUpdate:modelValue":a[9]||(a[9]=e=>o.visible=e),"max-width":"600"},{activator:h((({props:e})=>[f(u,y({color:"blue-lighten-1",text:"添加菜单"},e),null,16)])),default:h((()=>[f(C,{class:"form",onSubmit:a[8]||(a[8]=m((()=>{}),["prevent"])),ref:"form"},{default:h((()=>[f($,null,{default:h((()=>[f(g,null,{default:h((()=>[f(b,null,{default:h((()=>[f(p,null,{default:h((()=>[f(c,{label:"名称",rules:[e.$validator.required],modelValue:o.form.title,"onUpdate:modelValue":a[0]||(a[0]=e=>o.form.title=e)},null,8,["rules","modelValue"])])),_:1}),f(p,null,{default:h((()=>[f(c,{rules:[e.$validator.required,e.$validator.integer],label:"排序号",modelValue:o.form.sort,"onUpdate:modelValue":a[1]||(a[1]=e=>o.form.sort=e)},null,8,["rules","modelValue"])])),_:1})])),_:1}),f(b,null,{default:h((()=>[f(p,null,{default:h((()=>[f(w,{rules:[e.$validator.required],items:[{title:"菜单",value:"MENU"},{title:"页面",value:"PAGE"}],modelValue:o.form.type,"onUpdate:modelValue":a[2]||(a[2]=e=>o.form.type=e),label:"类型"},null,8,["rules","modelValue"])])),_:1}),f(p,null,{default:h((()=>[f(c,{label:"module",modelValue:o.form.module,"onUpdate:modelValue":a[3]||(a[3]=e=>o.form.module=e)},null,8,["modelValue"])])),_:1})])),_:1}),o.form.id?n("",!0):(l(),r(k,{key:0,itemTitle:"title",itemValue:"id",label:"上级菜单",items:i.parents,modelValue:o.form.parentId,"onUpdate:modelValue":a[4]||(a[4]=e=>o.form.parentId=e)},null,8,["items","modelValue"])),f(c,{label:"代码",modelValue:o.form.code,"onUpdate:modelValue":a[5]||(a[5]=e=>o.form.code=e)},null,8,["modelValue"]),f(c,{label:"路径",modelValue:o.form.path,"onUpdate:modelValue":a[6]||(a[6]=e=>o.form.path=e)},null,8,["modelValue"])])),_:1}),f(V,null,{default:h((()=>[f(x),f(_,{text:"Close",onClick:a[7]||(a[7]=e=>o.visible=!1)}),f(_,{disabled:o.submit_loading,loading:o.submit_loading,color:"primary",text:"Save",onClick:d.submit},null,8,["disabled","loading","onClick"])])),_:1})])),_:1})])),_:1},512)])),_:1},8,["modelValue"])}],["__scopeId","data-v-2fa6bb1d"]]),MenuPermissionDialog:e({data:()=>({headers:[{key:"name",width:"200",title:"名称",sortable:!1},{key:"code",title:"代码",sortable:!1},{key:"actions",width:"160",sortable:!1}],menuId:null,visible:!1,showAddRow:!0,modifyRowIdx:-1,dataList:[],formData:{modify:null,add:JSON.parse(JSON.stringify($))},authorityCodes:[]}),computed:{dataListView(){let e=[...this.dataList];return this.showAddRow&&e.push(q),-1!==this.modifyRowIdx&&(e[this.modifyRowIdx]=C),e}},methods:{show(e){this.menuId=e,this.visible=!0,this.$nextTick((()=>{this.requestAuthorityCodes(),this.requestPermissions()}))},async requestAuthorityCodes(){await this.$request.get({url:p.system.permission.codes}).then((e=>{this.authorityCodes=Object.keys(e).map((t=>({code:t,label:e[t]})))}))},async requestPermissions(){await this.$request.get({url:p.system.menu.permissions,params:{menuId:this.menuId}}).then((e=>{this.dataList=e}))},resetAddRow(){this.formData.add=JSON.parse(JSON.stringify($))},async tableBtnClick(e,t,l){switch(e){case"add":var{valid:a}=await this.$refs.form.validate();if(!a)return;Object.assign(this.formData.add,{menuId:this.menuId}),this.$request.post({url:p.system.permission.create,data:this.formData.add,json:!0}).then((()=>{this.resetAddRow(),this.requestPermissions()}));break;case"modify":-1!==this.modifyRowIdx?this.$message.error("请先完成修改的行"):(this.showAddRow=!1,this.formData.modify=JSON.parse(JSON.stringify(t)),this.modifyRowIdx=l);break;case"update":var{valid:a}=await this.$refs.form.validate();if(!a)return;this.$request.put({url:p.system.permission.update,data:{id:this.formData.modify.id,name:this.formData.modify.name,code:this.formData.modify.code},json:!0}).then((()=>{this.requestPermissions(),this.showAddRow=!0,this.formData.modify=null,this.modifyRowIdx=-1}));break;case"cancel":this.showAddRow=!0,this.formData.modify=null,this.modifyRowIdx=-1;break;case"delete":this.$confirm({message:"是否删除？"}).then((()=>{this.$request.delete({url:p.system.permission.delete,data:{id:t.id}}).then((()=>{this.requestPermissions()}))})).catch((()=>{}))}}},watch:{visible(e){e||this.$refs.form.reset()}}},[["render",function(e,o,d,c,p,v){const w=t("v-text-field"),k=t("v-list-item"),g=t("v-select"),x=t("v-btn-link"),_=t("v-data-table-virtual"),V=t("v-form"),$=t("v-card-text"),C=t("v-card"),q=t("v-dialog");return l(),r(q,{modelValue:p.visible,"onUpdate:modelValue":o[4]||(o[4]=e=>p.visible=e),"max-width":"620"},{default:h((()=>[f(C,null,{default:h((()=>[f($,null,{default:h((()=>[f(V,{ref:"form",onSubmit:o[3]||(o[3]=m((()=>{}),["prevent"]))},{default:h((()=>[f(_,{headers:p.headers,items:v.dataListView},{"item.name":h((({item:t})=>[t.rowType?(l(),r(w,{key:0,"validate-on":"submit",modelValue:p.formData[t.rowType].name,"onUpdate:modelValue":e=>p.formData[t.rowType].name=e,rules:[e.$validator.required]},null,8,["modelValue","onUpdate:modelValue","rules"])):(l(),a(s,{key:1},[b(u(t.name),1)],64))])),"item.code":h((({item:t})=>[t.rowType?(l(),r(g,{key:0,clearable:"","validate-on":"submit",rules:[e.$validator.required],items:p.authorityCodes,"item-title":"code","item-value":"code",modelValue:p.formData[t.rowType].code,"onUpdate:modelValue":e=>p.formData[t.rowType].code=e},{item:h((({props:e,item:t})=>[f(k,y({ripple:!1},e),{title:h((()=>[i("span",T,u(t.raw.code),1),i("span",I,u(t.raw.label),1)])),_:2},1040)])),_:2},1032,["rules","items","modelValue","onUpdate:modelValue"])):(l(),a(s,{key:1},[b(u(t.code),1)],64))])),"item.actions":h((({item:e,index:t})=>["add"===e.rowType?(l(),r(x,{key:0,type:"success",onClick:o[0]||(o[0]=e=>v.tableBtnClick("add")),text:"添加"})):"modify"===e.rowType?(l(),a(s,{key:1},[f(x,{onClick:o[1]||(o[1]=e=>v.tableBtnClick("update")),text:"保存"}),f(x,{onClick:o[2]||(o[2]=e=>v.tableBtnClick("cancel")),text:"取消"})],64)):(l(),a(s,{key:2},[f(x,{onClick:m((l=>v.tableBtnClick("modify",e,t)),["stop"]),text:"修改"},null,8,["onClick"]),-1===this.modifyRowIdx?(l(),r(x,{key:0,size:"small",icon:"mdi-delete",onClick:m((l=>v.tableBtnClick("delete",e,t)),["stop"])},null,8,["onClick"])):n("",!0)],64))])),_:1},8,["headers","items"])])),_:1},512)])),_:1})])),_:1})])),_:1},8,["modelValue"])}]]),TreeTable:V},data:()=>({loading:!1,tableHeaders:[{title:"标题",key:"title",width:180},{title:"module",key:"module",width:180},{title:"类型",key:"type",width:150,align:"center"},{title:"路径",key:"path"},{title:"代码",key:"code",width:300}],menus:[]}),computed:{},beforeMount(){this.$store.commit("update_sider_active","/system/menu")},beforeMount(){this.$store.commit("update_sider_active","/system/menus")},mounted(){this.request()},methods:{request(){this.loading=!0,this.$request.get({url:p.system.menu.list}).then((e=>{this.menus=e})).finally((()=>{this.loading=!1}))}}},[["render",function(e,s,o,d,n,r){const m=t("MenuDialog"),u=t("v-btn-link"),c=V;return l(),a("div",null,[f(m,{onSubmited:this.request,parents:n.menus},null,8,["onSubmited","parents"]),f(c,{headers:n.tableHeaders,items:n.menus,loading:n.loading},{"item.actions":h((({item:e})=>[i("td",D,[f(u,{text:"编辑"}),f(u,{text:"权限管理"})])])),_:1},8,["headers","items","loading"])])}]]);export{A as default};
