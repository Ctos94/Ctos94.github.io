import{_ as e,o as t,e as l,w as s,h as i,B as o,G as a,A as n,r as d,b as r,v as u,f as c,a as m,t as h,c as f,F as p,l as v}from"./index-9875c5e6.js";/* empty css                   */const b=e({components:{RoleDialog:e({components:{Dialog:e({props:{title:{type:String,default:""},visible:{type:Boolean,default:!1},width:{type:String,default:"500px"},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0}},computed:{visible_:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},methods:{closed(){this.$emit("closed")}}},[["render",function(e,n,d,r,u,c){const m=a;return t(),l(m,{width:d.width,"destroy-on-close":!0,title:d.title,modelValue:c.visible_,"onUpdate:modelValue":n[0]||(n[0]=e=>c.visible_=e),onClosed:c.closed,"close-on-click-modal":d.closeOnClickModal,"close-on-press-escape":d.closeOnPressEscape,"show-close":d.showClose},{footer:s((()=>[i("div",null,[o(e.$slots,"footer")])])),default:s((()=>[o(e.$slots,"body")])),_:3},8,["width","title","modelValue","onClosed","close-on-click-modal","close-on-press-escape","show-close"])}]])},data:()=>({submit_loading:!1,visible:!1,form:{}}),methods:{edit:function(e){this.form={...e},this.visible=!0},async submit(){const{valid:e}=await this.$refs.form.validate();e&&(this.submit_loading=!0,this.$request.execute({method:this.form.id?"put":"post",url:this.form.id?n.system.role.update:n.system.role.create,data:this.form,json:!0}).then((()=>{this.visible=!1,this.$emit("submited")})).finally((()=>{this.submit_loading=!1})))}},watch:{visible(e){e||this.$refs.form.reset()}}},[["render",function(e,i,o,a,n,m){const h=d("v-btn"),f=d("v-text-field"),p=d("v-card-text"),v=d("v-spacer"),b=d("v-btn-text"),y=d("v-card-actions"),g=d("v-card"),k=d("v-form"),_=d("v-dialog");return t(),l(_,{modelValue:n.visible,"onUpdate:modelValue":i[4]||(i[4]=e=>n.visible=e),"max-width":"350"},{activator:s((({props:e})=>[r(h,u({color:"blue-lighten-1",text:"新增角色"},e),null,16)])),default:s((()=>[r(k,{onSubmit:i[3]||(i[3]=c((()=>{}),["prevent"])),ref:"form"},{default:s((()=>[r(g,null,{default:s((()=>[r(p,null,{default:s((()=>[r(f,{rules:[e.$validator.required],label:"角色名称",modelValue:n.form.name,"onUpdate:modelValue":i[0]||(i[0]=e=>n.form.name=e)},null,8,["rules","modelValue"]),r(f,{rules:[e.$validator.required,e.$validator.integer],label:"排序号",modelValue:n.form.sort,"onUpdate:modelValue":i[1]||(i[1]=e=>n.form.sort=e)},null,8,["rules","modelValue"])])),_:1}),r(y,null,{default:s((()=>[r(v),r(b,{text:"Close",onClick:i[2]||(i[2]=e=>n.visible=!1)}),r(b,{disabled:n.submit_loading,loading:n.submit_loading,color:"primary",text:"Save",onClick:m.submit},null,8,["disabled","loading","onClick"])])),_:1})])),_:1})])),_:1},512)])),_:1},8,["modelValue"])}]]),UserMenusDialog:e({data:()=>({role_id:"",visible:!1,menus:[],selected:[]}),methods:{init(){const e=new Promise(((e,t)=>{this.$request.get({url:n.system.menu.tree}).then((t=>{e(t)}))})).then((e=>{this.menus=e})),t=new Promise(((e,t)=>{this.$request.get({url:n.system.role.authorization_ids,params:{roleId:this.role_id}}).then((t=>{e(t)}))})).then((e=>{this.selected=e}));Promise.all([e,t]).finally((()=>{}))},show:function(e){this.role_id=e,this.visible=!0,this.$nextTick((()=>{this.init()}))},isSelected(e){return-1!=this.selected.map((e=>e.id)).indexOf(e)},toggleSelect(e){let t=this.selected.map((e=>e.id)).indexOf(e.id);-1===t?this.selected.push({id:e.id,type:e.classify}):this.selected.splice(t,1)},save:function(){this.$request.post({url:n.system.role.update_authorization,data:{roleId:this.role_id,authorization:this.selected},json:!0}).then((()=>{this.$message.success("保存成功")}))}}},[["render",function(e,i,o,a,n,u){const b=d("v-checkbox"),y=d("v-treeview"),g=d("v-btn-text"),k=d("v-card"),_=d("v-dialog");return t(),l(_,{modelValue:n.visible,"onUpdate:modelValue":i[3]||(i[3]=e=>n.visible=e),width:"600",scrollable:""},{default:s((()=>[r(k,null,{actions:s((()=>[r(g,{onClick:i[1]||(i[1]=e=>n.visible=!1),text:"关闭"}),r(g,{color:"primary",onClick:i[2]||(i[2]=e=>u.save()),text:"确定"})])),default:s((()=>[r(y,{density:"compact",items:n.menus,"active-strategy":"classic"},{prepend:s((({item:e})=>[r(b,{density:"compact",onClick:i[0]||(i[0]=c((()=>{}),["stop"])),ripple:!1,"onUpdate:modelValue":t=>u.toggleSelect(e),"model-value":u.isSelected(e.id),"hide-details":!0},null,8,["onUpdate:modelValue","model-value"])])),title:s((({item:e})=>[m(h(e.title||e.name)+" ",1),"PAGE"===e.classify?(t(),f(p,{key:0},[m("[页面]")],64)):v("",!0),"PERMISSION"===e.classify?(t(),f(p,{key:1},[m("[权限]")],64)):v("",!0)])),_:1},8,["items"])])),_:1})])),_:1},8,["modelValue"])}]])},data:()=>({tableHeaders:[{title:"排序号",key:"sort",width:90,sortable:!1},{title:"角色",key:"name",sortable:!1},{title:"用户数",key:"userCount",width:100,align:"center",sortable:!1},{key:"actions",width:400,align:"center",sortable:!1}],roles:[]}),beforeMount(){this.$store.commit("update_sider_active","/system/roles")},mounted(){this.requestRoles()},methods:{requestRoles:function(){this.$request.get({url:n.system.role.all,loading:!0}).then((e=>{this.roles=e}))},del:function(e){this.$confirm({message:"是否要删除？"}).then((()=>{this.$request.delete({url:n.system.role.delete,data:{id:e}}).then((()=>{this.requestRoles()}))})).catch((()=>{}))}}},[["render",function(e,l,i,o,a,n){const u=d("RoleDialog"),c=d("UserMenusDialog"),m=d("v-btn-link"),h=d("v-data-table-virtual");return t(),f(p,null,[r(u,{ref:"RoleDialog",onSubmited:n.requestRoles},null,8,["onSubmited"]),r(c,{ref:"UserMenusDialog"},null,512),r(h,{headers:a.tableHeaders,items:a.roles},{"item.actions":s((({item:t})=>[r(m,{text:"编辑",onClick:l=>e.$refs.RoleDialog.edit(t)},null,8,["onClick"]),r(m,{onClick:()=>{e.$router.push({path:"/system/role/users",query:{id:t.id}})},text:"用户管理"},null,8,["onClick"]),r(m,{onClick:l=>e.$refs.UserMenusDialog.show(t.id),text:"菜单管理"},null,8,["onClick"]),r(m,{onClick:e=>n.del(t.id),text:"删除"},null,8,["onClick"])])),_:1},8,["headers","items"])],64)}]]);export{b as default};
