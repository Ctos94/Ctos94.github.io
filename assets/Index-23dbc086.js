import{_ as e,a2 as t,k as a,G as n,v as l,r as i,o as d,c as o,a as s,w as r,f as c,a3 as u,a4 as p,H as h,a5 as m,t as v,K as f,e as g,s as j,g as P,F as x,l as y,A as k,b as _,x as C,q as I,L as w,y as b,J as M,p as V,i as $,h as D,$ as S}from"./index-05cce328.js";import{a as U}from"./common-5afeacdf.js";const q=e({__name:"Projects",props:{projects:{type:Array,default:function(){return[]}}},emits:["selected","create","setting"],setup(e,{emit:_}){const C=t("currentProjectId"),I=_,w=a(!1),b=a({}),M=a(!0),V=a(!1),$=()=>{b.value.name&&(V.value=!0,y.post({url:k.plan.project.create,data:b.value,loading:{target:"#project_title"}}).then((e=>{I("create",e),w.value=!1})).finally((()=>{V.value=!1})))};return n(w,(e=>{e||(b.value={})})),n(M,(e=>{e&&l((()=>{const e=document.getElementById(`project-${C.value}`);e&&e.scrollIntoView()}))})),(t,a)=>{const n=i("v-btn"),l=i("v-list-item"),y=i("v-list"),k=i("v-badge"),_=i("v-sheet"),D=i("v-virtual-scroll"),S=i("v-text-field"),U=i("v-card-text"),q=i("v-card"),N=i("v-dialog");return d(),o(x,null,[s(y,{class:"pa-0"},{default:r((()=>[s(l,{ripple:!1,title:"项目",onClick:a[2]||(a[2]=e=>M.value=!M.value)},{append:r((()=>[s(n,{color:"blue-grey-lighten-2",class:"action-icon",variant:"text",ripple:!1,onClick:a[0]||(a[0]=c((e=>w.value=!w.value),["stop"])),icon:"mdi-plus"}),s(n,{color:"blue-grey-lighten-2",variant:"text",ripple:!1,onClick:a[1]||(a[1]=c((e=>M.value=!M.value),["stop"])),class:u({rotate:M.value,"rotate-t":!0,"action-icon":!0}),icon:"mdi-chevron-down"},null,8,["class"])])),_:1})])),_:1}),s(D,{style:{overflowX:"hidden"},"max-height":280,items:e.projects},{default:r((({item:e,index:t})=>[s(p,{name:"slide-x-reverse-transition"},{default:r((()=>[s(_,{title:e.name},{default:r((()=>[h(s(l,{title:e.name,id:`project-${e.id}`,onMouseenter:t=>e.showActions=!0,onMouseleave:t=>e.showActions=!1,class:u({item:!0,selected:v(C)==e.id}),value:e,color:"primary",onClick:a=>((e,t)=>{I("selected",e.id,t)})(e,t)},f({append:r((()=>[e.showActions?(d(),g(n,{key:0,color:"blue-grey-lighten-2",class:"action-icon",variant:"text",ripple:!1,onClick:c((a=>((e,t)=>{I("setting",e.id,t)})(e,t)),["stop"]),icon:"mdi-cog"},null,8,["onClick"])):j("",!0)])),_:2},[e.ingCount?{name:"prepend",fn:r((()=>[s(k,{class:"mr-1",content:e.ingCount,inline:""},null,8,["content"])])),key:"0"}:void 0]),1032,["title","id","onMouseenter","onMouseleave","class","value","onClick"]),[[m,M.value||v(C)==e.id]])])),_:2},1032,["title"])])),_:2},1024)])),_:1},8,["items"]),s(N,{persistent:V.value,class:"dialog",modelValue:w.value,"onUpdate:modelValue":a[4]||(a[4]=e=>w.value=e),width:"600px"},{default:r((()=>[s(q,{id:"project_title"},{default:r((()=>[s(U,{class:"pa-3"},{default:r((()=>[s(S,{"hide-details":"",modelValue:b.value.name,"onUpdate:modelValue":a[3]||(a[3]=e=>b.value.name=e),density:"compact",variant:"outlined",onKeydown:P($,["enter"]),label:"项目名"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["persistent","modelValue"])],64)}}},[["__scopeId","data-v-6dcc4d6f"]]),N=e({__name:"NewPlan",emits:["create"],setup(e,{emit:n}){const l=t("currentProjectId"),o=a(""),u=a(!1),p=a("inputRef"),h=n,m=()=>{p.value.error||y.post({url:k.plan.plan.create,data:{name:o.value,projectId:l.value},json:!0,loading:{target:"#newPlan"}}).then((e=>{h("create",e),o.value="",p.value.blur()}))};return(e,t)=>{const a=i("v-icon"),n=i("v-text-field"),l=i("v-validation"),h=i("v-sheet");return d(),g(h,{id:"newPlan",class:"d-flex justify-center"},{default:r((()=>[s(l,{rules:[e.$validator.required],modelValue:o.value,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value=e)},{default:r((({isValid:e})=>[s(n,{error:!!u.value&&!e.value,"onUpdate:focused":t[0]||(t[0]=e=>u.value=!u.value),ref_key:"inputRef",ref:p,"hide-details":"",modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),density:"compact",variant:"outlined",onKeydown:P(m,["enter"]),placeholder:"将任务添加到列表顶部"},f({_:2},[o.value?{name:"append-inner",fn:r((()=>[s(a,{onClick:c(m,["stop"]),icon:"mdi-plus"})])),key:"0"}:void 0]),1032,["error","modelValue"])])),_:1},8,["rules","modelValue"])])),_:1})}}},[["__scopeId","data-v-5149f10b"]]);const T=e({inject:["handleProjectIngCount"],props:{data:{type:Object},index:{type:Number}},data(){return{actions:!1,edit:!1,propsData:JSON.parse(JSON.stringify(this.data))}},computed:{deadline(){return this.data?U(new Date(this.data.deadline),"MM-dd"):""}},methods:{update(){this.edit&&!this.$refs.name.error&&this.$request.put({url:k.plan.plan.update,data:this.propsData,json:!0,loading:{target:`#plan-${this.data.id}`}}).then((()=>{this.$emit("update",this.propsData,this.index),this.edit=!1}))},handleClick(e){if("edit"===e)this.edit=!0,this.actions=!1},finish(){this.$request.post({url:k.plan.plan.finished,data:{id:this.data.id},loading:{target:`#plan-${this.data.id}`}}).then((()=>{this.$emit("update",{...this.data,finished:!0},this.index),this.handleProjectIngCount(-1)}))},again(){this.$request.post({url:k.plan.plan.again,data:{id:this.data.id},loading:{target:`#plan-${this.data.id}`}}).then((()=>{this.$emit("update",{...this.data,finished:!1},this.index),this.handleProjectIngCount(1)}))},hide(){this.$request.post({url:k.plan.plan.hide,data:{id:this.data.id},loading:{target:`#plan-${this.data.id}`}}).then((()=>{this.$emit("delete",this.index)}))},cancel(){this.edit=!1,this.propsData=JSON.parse(JSON.stringify(this.data))}},watch:{data(e){this.propsData=JSON.parse(JSON.stringify(e))}}},[["render",function(e,t,a,n,l,o){const p=i("v-btn"),h=i("v-sheet"),m=i("v-list-item"),v=i("v-text-field"),f=i("v-validation");return a.data.finished?(d(),g(h,{key:1},{default:r((()=>[s(m,{onMouseenter:t[7]||(t[7]=e=>l.actions=!0),onMouseleave:t[8]||(t[8]=e=>l.actions=!1),ripple:!1,class:"plan-item py-0 my-2 rounded pointer"},{append:r((()=>[l.actions?(d(),g(p,{key:0,title:"隐藏",class:"action-icon",onClick:c(o.hide,["stop"]),color:"blue-grey-lighten-2",icon:"mdi-eye-off-outline",variant:"text"},null,8,["onClick"])):j("",!0),l.actions?(d(),g(p,{key:1,title:"重新开始计划",class:"action-icon",onClick:c(o.again,["stop"]),color:"blue-grey-lighten-2",icon:"mdi-arrow-u-left-top",variant:"text"},null,8,["onClick"])):j("",!0)])),default:r((()=>[_(C(a.data.name)+" ",1)])),_:1})])),_:1})):(d(),g(h,{key:0},{default:r((()=>[l.edit?(d(),g(m,{key:1,class:"pa-0 my-2","min-height":"40"},{default:r((()=>[s(f,{modelValue:l.propsData.name,"onUpdate:modelValue":t[6]||(t[6]=e=>l.propsData.name=e),rules:[e.$validator.required]},{default:r((({isValid:e})=>[s(v,{ref:"name",error:!e.value,modelValue:l.propsData.name,"onUpdate:modelValue":t[5]||(t[5]=e=>l.propsData.name=e),"hide-details":"",autofocus:"",onKeyup:[P(o.update,["enter"]),P(o.cancel,["esc"])],onBlur:o.update,density:"compact",variant:"outlined"},null,8,["error","modelValue","onKeyup","onBlur"])])),_:1},8,["modelValue","rules"])])),_:1})):(d(),g(m,{key:0,onMouseenter:t[1]||(t[1]=e=>l.actions=!0),onMouseleave:t[2]||(t[2]=e=>l.actions=!1),onClick:t[3]||(t[3]=e=>o.handleClick("edit")),onContextmenu:t[4]||(t[4]=c((t=>{e.$emit("right-click",a.index,t)}),["prevent"])),ripple:!1,class:u({"plan-item py-0 my-2 rounded pointer":!0,"warning-deadline":a.data.deadline&&new Date(a.data.deadline)<new Date})},{append:r((()=>[l.actions?(d(),g(p,{key:0,title:"完成计划",class:"action-icon",onClick:c(o.finish,["stop"]),color:"blue-grey-lighten-2",icon:"mdi-check",variant:"text"},null,8,["onClick"])):j("",!0),a.data.deadline?(d(),g(h,{key:1,class:"d-flex justify-center",onClick:t[0]||(t[0]=c((()=>{e.$emit("handle-deadline",a.index)}),["stop"]))},{default:r((()=>[s(p,{class:"action-icon",color:"blue-grey-lighten-2",icon:"mdi-alarm",variant:"text"}),s(h,{class:"deadline-text",style:{position:"absolute","font-size":"10px",bottom:"2px"}},{default:r((()=>[_(C(o.deadline),1)])),_:1})])),_:1})):j("",!0)])),default:r((()=>[_(C(a.data.name)+" ",1)])),_:1},8,["class"]))])),_:1}))}],["__scopeId","data-v-a4ac871e"]]),L={components:{NewPlan:N,DatePicker:e({__name:"DatePicker",props:{data:{type:Object},index:{type:Number}},emits:["update","cancel"],setup(e,{emit:t}){const n=e,l=t,o=a(null);I((()=>{n.data&&n.data.deadline&&(o.value=new Date(n.data.deadline))}));const c=w((()=>U(new Date((new Date).getTime()+864e5),"yyyy-MM-dd"))),u=()=>{o&&h({...n.data,deadline:U(o.value,"yyyy-MM-dd")})},p=()=>{h({...n.data,deadline:null})},h=e=>{y.put({url:k.plan.plan.update,data:e,json:!0}).then((()=>{l("update",e,n.index),m()}))},m=()=>{l("cancel")};return(t,a)=>{const n=i("v-date-picker"),l=i("v-card-text"),h=i("v-icon"),v=i("v-btn"),f=i("v-card-actions"),P=i("v-card");return d(),g(P,{class:"date-picker"},{default:r((()=>[s(l,{class:"pa-0"},{default:r((()=>[s(n,{style:{width:"100%"},"show-adjacent-months":"",min:c.value,modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e)},null,8,["min","modelValue"])])),_:1}),s(f,null,{default:r((()=>[s(v,{title:"取消",onClick:m},{default:r((()=>[s(h,{icon:"mdi-close"})])),_:1}),e.data&&e.data.deadline?(d(),g(v,{key:0,title:"取消提醒",color:"primary",onClick:p},{default:r((()=>[s(h,{icon:"mdi-alarm-off"})])),_:1})):j("",!0),s(v,{title:"设置提醒",color:"primary",onClick:u},{default:r((()=>[s(h,{icon:"mdi-alarm"})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-cb67c989"]]),Plan:T},inject:["currentProjectId","handleProjectIngCount"],data:()=>({plans:[],showContextMenu:!1,contextMenuTop:0,contextMenuLeft:0,showDatePicker:!1,settingPlanIndex:-1,openFinished:!1}),computed:{hasTodoPlan(){return this.plans.filter((e=>!e.finished)).length>0},hasFinishedPlan(){return this.finishedPlanCount>0},finishedPlanCount(){return this.plans.filter((e=>e.finished)).length}},mounted(){document.addEventListener("click",this.handleContextMenu),document.addEventListener("keydown",this.handleContextMenu),this.requestPlans()},unmounted(){document.removeEventListener("click",this.handleContextMenu),document.removeEventListener("keydown",this.handleContextMenu)},methods:{requestPlans(){this.currentProjectId&&this.$request.get({url:k.plan.plan.list,params:{projectId:this.currentProjectId},loading:!0}).then((e=>{this.plans=e}))},inTopThree(e){return this.plans.filter((e=>e.finished)).map((e=>e.id)).splice(0,3).indexOf(e)>=0},addPlan(e){this.plans.splice(0,0,e),this.handleProjectIngCount(1)},handlePlanRightClick(e,t){this.showContextMenu||(this.showContextMenu=!0,this.contextMenuTop=t.clientY,this.contextMenuLeft=t.clientX,this.settingPlanIndex=e)},handleContextMenu(e){(e.key&&"Escape"===e.key&&this.showContextMenu||!e.key&&this.showContextMenu)&&(this.showContextMenu=!1)},handleContextMenuClick(e){switch(e.id){case"deadline":this.showDatePicker=!0;break;case"delete":let e=this.plans[this.settingPlanIndex].id;this.$confirm({message:"是否要删除该计划？"}).then((()=>{this.$request.delete({url:k.plan.plan.delete,data:{id:e},loading:{target:`#plan-${e}`}}).then((()=>{this.plans.splice(this.settingPlanIndex,1),this.handleProjectIngCount(-1)}))})).catch((()=>{}))}this.showContextMenu=!1},updatePlan(e,t){this.plans.splice(t,1,e)},deletePlan(e){this.plans.splice(e,1)},handleDeadline(e){this.settingPlanIndex=e,this.showDatePicker=!0}}},O=(e=>(V("data-v-1418d072"),e=e(),$(),e))((()=>D("p",null,"目前没有计划任务",-1)));const E=e({components:{Projects:q,ProjectContent:e(L,[["render",function(e,t,a,n,l,p){const v=i("v-sheet"),f=i("NewPlan"),P=i("Plan"),y=i("v-list"),k=i("v-btn"),C=i("v-list-item"),I=i("v-card"),w=i("v-expand-transition"),V=i("DatePicker"),$=i("v-dialog"),D=i("v-container");return d(),g(D,{id:"plans",style:{width:"70%"}},{default:r((()=>[p.currentProjectId?(d(),g(v,{key:1},{default:r((()=>[s(f,{onCreate:p.addPlan},null,8,["onCreate"]),s(v,{class:"d-flex justify-center text-h5 mt-10"},{default:r((()=>[_(" 进行中的计划 ")])),_:1}),p.hasTodoPlan?j("",!0):(d(),g(v,{key:0,class:"d-flex justify-center mt-2 mb-8"},{default:r((()=>[_(" 目前还没有进行中的计划 ")])),_:1})),s(y,null,{default:r((()=>[(d(!0),o(x,null,b(l.plans,((e,t)=>(d(),o(x,{key:t},[e.finished?j("",!0):(d(),g(v,{key:0,id:`plan-${e.id}`},{default:r((()=>[s(P,{data:e,index:t,onHandleDeadline:e=>p.handleDeadline(t),onRightClick:p.handlePlanRightClick,onUpdate:p.updatePlan},null,8,["data","index","onHandleDeadline","onRightClick","onUpdate"])])),_:2},1032,["id"]))],64)))),128))])),_:1}),p.hasFinishedPlan?(d(),g(v,{key:1},{default:r((()=>[s(v,{class:"d-flex justify-center text-h5 mt-10"},{default:r((()=>[_(" 完成的计划 ")])),_:1}),s(y,null,{default:r((()=>[(d(!0),o(x,null,b(l.plans,((e,t)=>(d(),o(x,{key:t},[e.finished&&p.inTopThree(e.id)||e.finished&&l.openFinished?(d(),g(v,{key:0,id:`plan-${e.id}`},{default:r((()=>[s(P,{class:"text-disabled",data:e,index:t,onDelete:p.deletePlan,onUpdate:p.updatePlan},null,8,["data","index","onDelete","onUpdate"])])),_:2},1032,["id"])):j("",!0)],64)))),128)),p.finishedPlanCount>3?(d(),g(C,{key:0,style:{marginTop:"-10px"},class:"d-flex justify-center"},{default:r((()=>[s(k,{color:"blue-grey-lighten-2",variant:"text",ripple:!1,onClick:t[0]||(t[0]=c((e=>l.openFinished=!l.openFinished),["stop"])),class:u({rotate:l.openFinished,"rotate-t":!0,"action-icon":!0}),icon:"mdi-chevron-down"},null,8,["class"])])),_:1})):j("",!0)])),_:1})])),_:1})):j("",!0)])),_:1})):(d(),g(v,{key:0,class:"d-flex justify-center"},{default:r((()=>[O])),_:1})),s(w,null,{default:r((()=>[h(s(I,{style:M({top:`${l.contextMenuTop}px`,left:`${l.contextMenuLeft}px`}),class:"contextmenu"},{default:r((()=>[s(y,{width:"150",class:"pa-0","onClick:select":p.handleContextMenuClick},{default:r((()=>[s(C,{elevation:"0",variant:"elevated",value:"deadline",ripple:!1,"prepend-icon":"mdi-alarm",title:"提醒"}),s(C,{elevation:"0",variant:"elevated",value:"delete",ripple:!1,"prepend-icon":"mdi-trash-can-outline",title:"删除"})])),_:1},8,["onClick:select"])])),_:1},8,["style"]),[[m,l.showContextMenu]])])),_:1}),s($,{modelValue:l.showDatePicker,"onUpdate:modelValue":t[2]||(t[2]=e=>l.showDatePicker=e),width:"400"},{default:r((()=>[s(V,{data:l.plans[l.settingPlanIndex],index:l.settingPlanIndex,onCancel:t[1]||(t[1]=e=>l.showDatePicker=!1),onUpdate:p.updatePlan},null,8,["data","index","onUpdate"])])),_:1},8,["modelValue"])])),_:1})}],["__scopeId","data-v-1418d072"]]),ProjectSetting:e({__name:"ProjectSetting",emits:["update"],setup(e,{emit:n}){const l=t("currentProjectId"),o=t("currentProjectIndex"),c=t("reload"),u=t("updateProject"),p=a({}),h=a(!1);I((()=>{m()}));const m=()=>{y.get({url:k.plan.project.detail,params:{id:l.value},loading:!0}).then((e=>{p.value=e}))},v=()=>{S({message:"删除后数据无法找回，确定要删除吗？",beforeClose:(e,t,a)=>{"confirm"===e?(t.confirmButtonLoading=!0,y.delete({url:k.plan.project.delete,data:{id:l.value}}).then((()=>{a()}))):a()}}).then((()=>{c()})).catch((()=>{}))};return(e,t)=>{const a=i("v-btn"),n=i("v-text-field"),c=i("v-confirm-edit"),m=i("v-sheet"),f=i("v-container");return d(),g(f,null,{default:r((()=>[s(m,{id:"setting"},{default:r((()=>[s(m,{class:"confirm-edit"},{default:r((()=>[s(c,{modelValue:p.value.name,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value.name=e),ref:"edit"},{default:r((({model:i,actions:c,isPristine:h})=>[s(n,{rules:[e.$validator.required],"hide-details":"",density:"compact",variant:"outlined",label:"项目名称",modelValue:i.value,"onUpdate:modelValue":e=>i.value=e},{append:r((()=>[s(a,{class:"update_btn",color:"blue-lighten-1",onClick:()=>{var e;h||(e=i.value)&&y.put({url:k.plan.project.update,data:{id:l.value,name:e},loading:{target:".update_btn"},json:!0}).then((()=>{p.value.name=e,u(p.value,o.value,["name"])}))},text:"重命名"},null,8,["onClick"]),h?j("",!0):(d(),g(a,{key:0,class:"ml-2 update_btn",color:"grey-lighten-3",onClick:t[0]||(t[0]=t=>e.$refs.edit.cancel()),text:"取消"}))])),_:2},1032,["rules","modelValue","onUpdate:modelValue"])])),_:1},8,["modelValue"])])),_:1}),s(a,{loading:h.value,ripple:!1,"prepend-icon":"mdi-alert",class:"mt-4","max-width":"300",color:"red-lighten-2",text:"删除项目",variant:"outlined",onClick:v},null,8,["loading"])])),_:1})])),_:1})}}},[["__scopeId","data-v-76bdd1d1"]])},data:()=>({projects:[],currentProjectIndex:-1,currentProjectId:void 0,showSetting:!1}),provide(){return{currentProjectId:w((()=>this.currentProjectId)),reload:this.reload,handleProjectIngCount:this.handleProjectIngCount,currentProjectIndex:w((()=>this.currentProjectIndex)),updateProject:this.updateProject}},beforeMount(){this.$store.commit("update_header_active","PLAN_INDEX")},mounted(){this.requestProjects()},methods:{requestProjects(){this.$request.get({url:k.plan.project.list,loading:!0}).then((e=>{this.projects=e,this.projects.length>0?(this.currentProjectId=this.projects[0].id,this.currentProjectIndex=0):(this.currentProjectIndex=-1,this.currentProjectId=void 0)}))},selectedProject(e,t){this.currentProjectId=e,this.currentProjectIndex=t,this.showSetting=!1},addProject(e){this.projects.splice(0,0,e),this.currentProjectId=e.id,this.currentProjectIndex=0},updateProject(e,t,a){a&&a.length>0?a.forEach((a=>{this.projects[t][a]=e[a]})):this.projects.splice(t,1,e)},settingProject(e,t){this.currentProjectId=e,this.currentProjectIndex=t,this.showSetting=!0},reload(){this.showSetting=!1,this.$nextTick((()=>{this.requestProjects()}))},handleProjectIngCount(e){void 0===this.projects[this.currentProjectIndex].ingCount&&(this.projects[this.currentProjectIndex].ingCount=0),e<0&&this.projects[this.currentProjectIndex].ingCount<=0||(this.projects[this.currentProjectIndex].ingCount+=e)}}},[["render",function(e,t,a,n,l,c){const u=i("Projects"),p=i("v-navigation-drawer"),h=i("ProjectContent"),m=i("ProjectSetting"),v=i("v-container"),f=i("v-main");return d(),o(x,null,[s(p,{width:"300"},{default:r((()=>[s(u,{projects:l.projects,onSelected:c.selectedProject,onCreate:c.addProject,onSetting:c.settingProject},null,8,["projects","onSelected","onCreate","onSetting"])])),_:1}),s(f,null,{default:r((()=>[(d(),g(v,{key:l.currentProjectId},{default:r((()=>[l.showSetting?(d(),g(m,{key:1})):(d(),g(h,{key:0}))])),_:1}))])),_:1})],64)}]]);export{E as default};
