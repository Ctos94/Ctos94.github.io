import{_ as e,A as t,r as n,o as a,c as i,b as l,w as d,f as o,S as s,T as r,x as c,U as u,C as h,e as p,l as m,g as f,F as j,a as g,t as v,n as P,z as x,p as k,i as y,h as C,D as _}from"./index-b6422c35.js";import{a as I}from"./common-5afeacdf.js";const w=e({inject:["currentProjectId"],emits:["selected","create","setting"],props:{projects:{type:Array,default:function(){return[]}}},data:()=>({visible:!1,formData:{},open:!0,lockDialog:!1}),methods:{handleSetting(e,t){this.$emit("setting",e.id,t)},handleCellClick(e,t){this.$emit("selected",e.id,t)},create(){this.formData.name&&(this.lockDialog=!0,this.$request.post({url:t.plan.project.create,data:this.formData,loading:{target:"#project_title"}}).then((e=>{this.$emit("create",e),this.visible=!1})).finally((()=>{this.lockDialog=!1})))}},watch:{visible(e){e||(this.formData={})},open(e){e&&this.$nextTick((()=>{const e=document.getElementById(`project-${this.currentProjectId}`);e&&e.scrollIntoView()}))}}},[["render",function(e,t,g,v,P,x){const k=n("v-btn"),y=n("v-list-item"),C=n("v-list"),_=n("v-badge"),I=n("v-sheet"),w=n("v-virtual-scroll"),$=n("v-text-field"),b=n("v-card-text"),D=n("v-card"),M=n("v-dialog");return a(),i(j,null,[l(C,{class:"pa-0"},{default:d((()=>[l(y,{ripple:!1,title:"项目",onClick:t[2]||(t[2]=e=>P.open=!P.open)},{append:d((()=>[l(k,{color:"blue-grey-lighten-2",class:"action-icon",variant:"text",ripple:!1,onClick:t[0]||(t[0]=o((e=>P.visible=!P.visible),["stop"])),icon:"mdi-plus"}),l(k,{color:"blue-grey-lighten-2",variant:"text",ripple:!1,onClick:t[1]||(t[1]=o((e=>P.open=!P.open),["stop"])),class:s({rotate:P.open,"rotate-t":!0,"action-icon":!0}),icon:"mdi-chevron-down"},null,8,["class"])])),_:1})])),_:1}),l(w,{style:{overflowX:"hidden"},"max-height":280,items:g.projects},{default:d((({item:e,index:t})=>[l(r,{name:"slide-x-reverse-transition"},{default:d((()=>[l(I,{title:e.name},{default:d((()=>[c(l(y,{title:e.name,id:`project-${e.id}`,onMouseenter:t=>e.showActions=!0,onMouseleave:t=>e.showActions=!1,class:s({item:!0,selected:x.currentProjectId==e.id}),value:e,color:"primary",onClick:n=>x.handleCellClick(e,t)},h({append:d((()=>[e.showActions?(a(),p(k,{key:0,color:"blue-grey-lighten-2",class:"action-icon",variant:"text",ripple:!1,onClick:o((n=>x.handleSetting(e,t)),["stop"]),icon:"mdi-cog"},null,8,["onClick"])):m("",!0)])),_:2},[e.ingCount?{name:"prepend",fn:d((()=>[l(_,{class:"mr-1",content:e.ingCount,inline:""},null,8,["content"])])),key:"0"}:void 0]),1032,["title","id","onMouseenter","onMouseleave","class","value","onClick"]),[[u,P.open||x.currentProjectId==e.id]])])),_:2},1032,["title"])])),_:2},1024)])),_:1},8,["items"]),l(M,{persistent:P.lockDialog,class:"dialog",modelValue:P.visible,"onUpdate:modelValue":t[4]||(t[4]=e=>P.visible=e),width:"600px"},{default:d((()=>[l(D,{id:"project_title"},{default:d((()=>[l(b,{class:"pa-3"},{default:d((()=>[l($,{"hide-details":"",modelValue:P.formData.name,"onUpdate:modelValue":t[3]||(t[3]=e=>P.formData.name=e),density:"compact",variant:"outlined",onKeydown:f(x.create,["enter"]),label:"项目名"},null,8,["modelValue","onKeydown"])])),_:1})])),_:1})])),_:1},8,["persistent","modelValue"])],64)}],["__scopeId","data-v-13e4d8d1"]]);const $=e({inject:["currentProjectId"],data:()=>({name:"",focus:!1}),methods:{create(){this.$refs.input.error||this.$request.post({url:t.plan.plan.create,data:{name:this.name,projectId:this.currentProjectId},json:!0,loading:{target:"#newPlan"}}).then((e=>{this.$emit("create",e),this.name="",this.$refs.input.blur()}))}}},[["render",function(e,t,i,s,r,c){const u=n("v-icon"),m=n("v-text-field"),j=n("v-validation"),g=n("v-sheet");return a(),p(g,{id:"newPlan",class:"d-flex justify-center"},{default:d((()=>[l(j,{rules:[e.$validator.required],modelValue:r.name,"onUpdate:modelValue":t[2]||(t[2]=e=>r.name=e)},{default:d((({isValid:e})=>[l(m,{error:!!r.focus&&!e.value,"onUpdate:focused":t[0]||(t[0]=e=>r.focus=!r.focus),ref:"input","hide-details":"",modelValue:r.name,"onUpdate:modelValue":t[1]||(t[1]=e=>r.name=e),density:"compact",variant:"outlined",onKeydown:f(c.create,["enter"]),placeholder:"将任务添加到列表顶部"},h({_:2},[r.name?{name:"append-inner",fn:d((()=>[l(u,{onClick:o(c.create,["stop"]),icon:"mdi-plus"},null,8,["onClick"])])),key:"0"}:void 0]),1032,["error","modelValue","onKeydown"])])),_:1},8,["rules","modelValue"])])),_:1})}],["__scopeId","data-v-ecbdfbce"]]);const b=e({inject:["handleProjectIngCount"],props:{data:{type:Object},index:{type:Number}},data(){return{actions:!1,edit:!1,propsData:this.data}},computed:{deadline(){return this.data?I(new Date(this.data.deadline),"MM-dd"):""}},methods:{update(){this.edit&&!this.$refs.name.error&&this.$request.put({url:t.plan.plan.update,data:this.propsData,json:!0,loading:{target:`#plan-${this.data.id}`}}).then((()=>{this.$emit("update",this.propsData,this.index),this.edit=!1}))},handleClick(e){if("edit"===e)this.edit=!0,this.actions=!1},finish(){this.$request.post({url:t.plan.plan.finished,data:{id:this.data.id},loading:{target:`#plan-${this.data.id}`}}).then((()=>{this.$emit("update",{...this.data,finished:!0},this.index),this.handleProjectIngCount(-1)}))},again(){this.$request.post({url:t.plan.plan.again,data:{id:this.data.id},loading:{target:`#plan-${this.data.id}`}}).then((()=>{this.$emit("update",{...this.data,finished:!1},this.index),this.handleProjectIngCount(1)}))}},watch:{data(e){this.propsData=e}}},[["render",function(e,t,i,r,c,u){const h=n("v-btn"),j=n("v-sheet"),P=n("v-list-item"),x=n("v-text-field"),k=n("v-validation");return i.data.finished?(a(),p(j,{key:1},{default:d((()=>[l(P,{ripple:!1,class:"plan-item py-0 my-2 rounded pointer"},{append:d((()=>[l(h,{title:"重新开始计划",class:"action-icon",onClick:o(u.again,["stop"]),color:"blue-grey-lighten-2",icon:"mdi-arrow-u-left-top",variant:"text"},null,8,["onClick"])])),default:d((()=>[g(v(i.data.name)+" ",1)])),_:1})])),_:1})):(a(),p(j,{key:0},{default:d((()=>[c.edit?(a(),p(P,{key:1,class:"pa-0 my-2","min-height":"40"},{default:d((()=>[l(k,{modelValue:c.propsData.name,"onUpdate:modelValue":t[6]||(t[6]=e=>c.propsData.name=e),rules:[e.$validator.required]},{default:d((({isValid:e})=>[l(x,{ref:"name",error:!e.value,modelValue:c.propsData.name,"onUpdate:modelValue":t[5]||(t[5]=e=>c.propsData.name=e),"hide-details":"",autofocus:"",onKeyup:f(u.update,["enter"]),onBlur:u.update,density:"compact",variant:"outlined"},null,8,["error","modelValue","onKeyup","onBlur"])])),_:1},8,["modelValue","rules"])])),_:1})):(a(),p(P,{key:0,onMouseenter:t[1]||(t[1]=e=>c.actions=!0),onMouseleave:t[2]||(t[2]=e=>c.actions=!1),onClick:t[3]||(t[3]=e=>u.handleClick("edit")),onContextmenu:t[4]||(t[4]=o((t=>{e.$emit("right-click",i.index,t)}),["prevent"])),ripple:!1,class:s({"plan-item py-0 my-2 rounded pointer":!0,"warning-deadline":i.data.deadline&&new Date(i.data.deadline)<new Date})},{append:d((()=>[c.actions?(a(),p(h,{key:0,title:"完成计划",class:"action-icon",onClick:o(u.finish,["stop"]),color:"blue-grey-lighten-2",icon:"mdi-check",variant:"text"},null,8,["onClick"])):m("",!0),i.data.deadline?(a(),p(j,{key:1,class:"d-flex justify-center",onClick:t[0]||(t[0]=o((()=>{e.$emit("handle-deadline",i.index)}),["stop"]))},{default:d((()=>[l(h,{class:"action-icon",color:"blue-grey-lighten-2",icon:"mdi-alarm",variant:"text"}),l(j,{class:"deadline-text",style:{position:"absolute","font-size":"10px",bottom:"2px"}},{default:d((()=>[g(v(u.deadline),1)])),_:1})])),_:1})):m("",!0)])),default:d((()=>[g(v(i.data.name)+" ",1)])),_:1},8,["class"]))])),_:1}))}],["__scopeId","data-v-6b284e74"]]);const D={components:{NewPlan:$,DatePicker:e({props:{data:{type:Object},index:{type:Number}},data(){return{deadline:this.data&&this.data.deadline?new Date(this.data.deadline):null}},computed:{min:()=>I(new Date((new Date).getTime()+864e5),"yyyy-MM-dd")},methods:{confirm(){this.deadline&&this.update({...this.data,deadline:I(this.deadline,"yyyy-MM-dd")})},clear(){this.update({...this.data,deadline:null})},update(e){this.$request.put({url:t.plan.plan.update,data:e,json:!0}).then((()=>{this.$emit("update",e,this.index),this.cancel()}))},cancel(){this.$emit("cancel")}}},[["render",function(e,t,i,o,s,r){const c=n("v-date-picker"),u=n("v-card-text"),h=n("v-icon"),f=n("v-btn"),j=n("v-card-actions"),g=n("v-card");return a(),p(g,{class:"date-picker"},{default:d((()=>[l(u,{class:"pa-0"},{default:d((()=>[l(c,{style:{width:"100%"},"show-adjacent-months":"",min:r.min,modelValue:s.deadline,"onUpdate:modelValue":t[0]||(t[0]=e=>s.deadline=e)},null,8,["min","modelValue"])])),_:1}),l(j,null,{default:d((()=>[l(f,{title:"取消",onClick:r.cancel},{default:d((()=>[l(h,{icon:"mdi-close"})])),_:1},8,["onClick"]),this.data&&this.data.deadline?(a(),p(f,{key:0,title:"取消提醒",color:"primary",onClick:r.clear},{default:d((()=>[l(h,{icon:"mdi-alarm-off"})])),_:1},8,["onClick"])):m("",!0),l(f,{title:"设置提醒",color:"primary",onClick:r.confirm},{default:d((()=>[l(h,{icon:"mdi-alarm"})])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-0dff5d8f"]]),Plan:b},inject:["currentProjectId","handleProjectIngCount"],data:()=>({plans:[],showContextMenu:!1,contextMenuTop:0,contextMenuLeft:0,showDatePicker:!1,settingPlanIndex:-1,openFinished:!1}),computed:{hasTodoPlan(){return this.plans.filter((e=>!e.finished)).length>0},hasFinishedPlan(){return this.finishedPlanCount>0},finishedPlanCount(){return this.plans.filter((e=>e.finished)).length}},mounted(){document.addEventListener("click",this.handleContextMenu),document.addEventListener("keydown",this.handleContextMenu),this.requestPlans()},unmounted(){document.removeEventListener("click",this.handleContextMenu),document.removeEventListener("keydown",this.handleContextMenu)},methods:{requestPlans(){this.currentProjectId&&this.$request.get({url:t.plan.plan.list,params:{projectId:this.currentProjectId},loading:{target:"#plans"}}).then((e=>{this.plans=e}))},inTopThree(e){return this.plans.filter((e=>e.finished)).map((e=>e.id)).splice(0,3).indexOf(e)>=0},addPlan(e){this.plans.splice(0,0,e),this.handleProjectIngCount(1)},handlePlanRightClick(e,t){this.showContextMenu||(this.showContextMenu=!0,this.contextMenuTop=t.clientY,this.contextMenuLeft=t.clientX,this.settingPlanIndex=e)},handleContextMenu(e){(e.key&&"Escape"===e.key&&this.showContextMenu||!e.key&&this.showContextMenu)&&(this.showContextMenu=!1)},handleContextMenuClick(e){switch(e.id){case"deadline":this.showDatePicker=!0;break;case"delete":let e=this.plans[this.settingPlanIndex].id;this.$confirm({message:"是否要删除该计划？"}).then((()=>{this.$request.delete({url:t.plan.plan.delete,data:{id:e},loading:{target:`#plan-${e}`}}).then((()=>{this.plans.splice(this.settingPlanIndex,1),this.handleProjectIngCount(-1)}))})).catch((()=>{}))}this.showContextMenu=!1},updatePlan(e,t){this.plans.splice(t,1,e)},handleDeadline(e){this.settingPlanIndex=e,this.showDatePicker=!0}}},M=(e=>(k("data-v-80116706"),e=e(),y(),e))((()=>C("p",null,"目前没有计划任务",-1)));const V=e({components:{Projects:w,ProjectContent:e(D,[["render",function(e,t,r,h,f,v){const k=n("v-sheet"),y=n("NewPlan"),C=n("Plan"),_=n("v-list"),I=n("v-btn"),w=n("v-list-item"),$=n("v-card"),b=n("v-expand-transition"),D=n("DatePicker"),V=n("v-dialog"),q=n("v-container");return a(),p(q,{id:"plans",style:{width:"70%"}},{default:d((()=>[v.currentProjectId?(a(),p(k,{key:1},{default:d((()=>[l(y,{onCreate:v.addPlan},null,8,["onCreate"]),l(k,{class:"d-flex justify-center text-h5 mt-10"},{default:d((()=>[g(" 进行中的计划 ")])),_:1}),v.hasTodoPlan?m("",!0):(a(),p(k,{key:0,class:"d-flex justify-center mt-2 mb-8"},{default:d((()=>[g(" 目前还没有进行中的计划 ")])),_:1})),l(_,null,{default:d((()=>[(a(!0),i(j,null,P(f.plans,((e,t)=>(a(),i(j,{key:t},[e.finished?m("",!0):(a(),p(k,{key:0,id:`plan-${e.id}`},{default:d((()=>[l(C,{data:e,index:t,onHandleDeadline:e=>v.handleDeadline(t),onRightClick:v.handlePlanRightClick,onUpdate:v.updatePlan},null,8,["data","index","onHandleDeadline","onRightClick","onUpdate"])])),_:2},1032,["id"]))],64)))),128))])),_:1}),v.hasFinishedPlan?(a(),p(k,{key:1},{default:d((()=>[l(k,{class:"d-flex justify-center text-h5 mt-10"},{default:d((()=>[g(" 完成的计划 ")])),_:1}),l(_,null,{default:d((()=>[(a(!0),i(j,null,P(f.plans,((e,t)=>(a(),i(j,{key:t},[e.finished&&v.inTopThree(e.id)||e.finished&&f.openFinished?(a(),p(k,{key:0,id:`plan-${e.id}`},{default:d((()=>[l(C,{data:e,index:t,onUpdate:v.updatePlan},null,8,["data","index","onUpdate"])])),_:2},1032,["id"])):m("",!0)],64)))),128)),v.finishedPlanCount>3?(a(),p(w,{key:0,style:{marginTop:"-10px"},class:"d-flex justify-center"},{default:d((()=>[l(I,{color:"blue-grey-lighten-2",variant:"text",ripple:!1,onClick:t[0]||(t[0]=o((e=>f.openFinished=!f.openFinished),["stop"])),class:s({rotate:f.openFinished,"rotate-t":!0,"action-icon":!0}),icon:"mdi-chevron-down"},null,8,["class"])])),_:1})):m("",!0)])),_:1})])),_:1})):m("",!0)])),_:1})):(a(),p(k,{key:0,class:"d-flex justify-center"},{default:d((()=>[M])),_:1})),l(b,null,{default:d((()=>[c(l($,{style:x({top:`${f.contextMenuTop}px`,left:`${f.contextMenuLeft}px`}),class:"contextmenu"},{default:d((()=>[l(_,{width:"150",class:"pa-0","onClick:select":v.handleContextMenuClick},{default:d((()=>[l(w,{elevation:"0",variant:"elevated",value:"deadline",ripple:!1,"prepend-icon":"mdi-alarm",title:"提醒"}),l(w,{elevation:"0",variant:"elevated",value:"delete",ripple:!1,"prepend-icon":"mdi-trash-can-outline",title:"删除"})])),_:1},8,["onClick:select"])])),_:1},8,["style"]),[[u,f.showContextMenu]])])),_:1}),l(V,{modelValue:f.showDatePicker,"onUpdate:modelValue":t[2]||(t[2]=e=>f.showDatePicker=e),width:"400"},{default:d((()=>[l(D,{data:f.plans[f.settingPlanIndex],index:f.settingPlanIndex,onCancel:t[1]||(t[1]=e=>f.showDatePicker=!1),onUpdate:v.updatePlan},null,8,["data","index","onUpdate"])])),_:1},8,["modelValue"])])),_:1})}],["__scopeId","data-v-80116706"]]),ProjectSetting:e({props:{ddd:{type:Object,default:{}}},inject:["currentProjectId","reload","currentProjectIndex","updateProject"],emits:["update"],data:()=>({project:{},delLoading:!1}),mounted(){this.requestDetail()},methods:{requestDetail(){this.$request.get({url:t.plan.project.detail,params:{id:this.currentProjectId},loading:{target:"#setting"}}).then((e=>{this.project=this.ddd}))},del(){this.$confirm({message:"删除后数据无法找回，确定要删除吗？",beforeClose:(e,n,a)=>{"confirm"===e?(n.confirmButtonLoading=!0,this.$request.delete({url:t.plan.project.delete,data:{id:this.currentProjectId}}).then((()=>{a()}))):a()}}).then((()=>{this.reload()})).catch((()=>{}))},save(e){e&&this.$request.put({url:t.plan.project.update,data:{id:this.currentProjectId,name:e},loading:{target:".update_btn"},json:!0}).then((()=>{this.project.name=e,this.updateProject(this.project,this.currentProjectIndex,["name"])}))}}},[["render",function(e,t,i,o,s,r){const c=n("v-btn"),u=n("v-text-field"),h=n("v-confirm-edit"),f=n("v-sheet"),j=n("v-container");return a(),p(j,null,{default:d((()=>[l(f,{id:"setting"},{default:d((()=>[l(f,{class:"confirm-edit"},{default:d((()=>[l(h,{modelValue:s.project.name,"onUpdate:modelValue":t[1]||(t[1]=e=>s.project.name=e),ref:"edit"},{default:d((({model:n,actions:i,isPristine:o})=>[l(u,{rules:[e.$validator.required],"hide-details":"",density:"compact",variant:"outlined",label:"项目名称",modelValue:n.value,"onUpdate:modelValue":e=>n.value=e},{append:d((()=>[l(c,{class:"update_btn",color:"blue-lighten-1",onClick:()=>{o||r.save(n.value)},text:"重命名"},null,8,["onClick"]),o?m("",!0):(a(),p(c,{key:0,class:"ml-2 update_btn",color:"grey-lighten-3",onClick:t[0]||(t[0]=t=>e.$refs.edit.cancel()),text:"取消"}))])),_:2},1032,["rules","modelValue","onUpdate:modelValue"])])),_:1},8,["modelValue"])])),_:1}),l(c,{loading:s.delLoading,ripple:!1,"prepend-icon":"mdi-alert",class:"mt-4","max-width":"300",color:"red-lighten-2",text:"删除项目",variant:"outlined",onClick:r.del},null,8,["loading","onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-fb1e539c"]])},data:()=>({projects:[],currentProjectIndex:-1,currentProjectId:void 0,showSetting:!1,ddd:{}}),provide(){return{currentProjectId:_((()=>this.currentProjectId)),reload:this.reload,handleProjectIngCount:this.handleProjectIngCount,currentProjectIndex:_((()=>this.currentProjectIndex)),updateProject:this.updateProject}},beforeMount(){this.$store.commit("update_header_active","/plan")},mounted(){this.requestProjects()},methods:{requestProjects(){this.$request.get({url:t.plan.project.list,loading:!0}).then((e=>{this.projects=e,this.projects.length>0?(this.currentProjectId=this.projects[0].id,this.currentProjectIndex=0):(this.currentProjectIndex=-1,this.currentProjectId=void 0)}))},selectedProject(e,t){this.currentProjectId=e,this.currentProjectIndex=t,this.showSetting=!1},addProject(e){this.projects.splice(0,0,e),this.currentProjectId=e.id,this.currentProjectIndex=0},updateProject(e,t,n){n&&n.length>0?n.forEach((n=>{this.projects[t][n]=e[n]})):this.projects.splice(t,1,e)},settingProject(e,t){this.currentProjectId=e,this.currentProjectIndex=t,this.ddd=this.projects[t],this.$nextTick((()=>{this.showSetting=!0}))},reload(){this.showSetting=!1,this.$nextTick((()=>{this.requestProjects()}))},handleProjectIngCount(e){void 0===this.projects[this.currentProjectIndex].ingCount&&(this.projects[this.currentProjectIndex].ingCount=0),e<0&&this.projects[this.currentProjectIndex].ingCount<=0||(this.projects[this.currentProjectIndex].ingCount+=e)}}},[["render",function(e,t,o,s,r,c){const u=n("Projects"),h=n("v-navigation-drawer"),m=n("ProjectContent"),f=n("ProjectSetting"),g=n("v-container"),v=n("v-main");return a(),i(j,null,[l(h,{width:"300"},{default:d((()=>[l(u,{projects:r.projects,onSelected:c.selectedProject,onCreate:c.addProject,onSetting:c.settingProject},null,8,["projects","onSelected","onCreate","onSetting"])])),_:1}),l(v,null,{default:d((()=>[l(g,null,{default:d((()=>[r.showSetting?(a(),p(f,{ddd:r.ddd,key:r.currentProjectId},null,8,["ddd"])):(a(),p(m,{key:r.currentProjectId}))])),_:1})])),_:1})],64)}]]);export{V as default};
