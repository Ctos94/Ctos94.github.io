import{_ as b,o as v,e as x,w as r,h as D,B as w,G as U,A as p,r as i,b as l,v as R,f as V,a as g,t as M,c as y,F as k,l as $}from"./index-3676d8ee.js";/* empty css                   */const B={props:{title:{type:String,default:""},visible:{type:Boolean,default:!1},width:{type:String,default:"500px"},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0}},computed:{visible_:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},methods:{closed(){this.$emit("closed")}}};function P(e,t,o,_,s,a){const f=U;return v(),x(f,{width:o.width,"destroy-on-close":!0,title:o.title,modelValue:a.visible_,"onUpdate:modelValue":t[0]||(t[0]=c=>a.visible_=c),onClosed:a.closed,"close-on-click-modal":o.closeOnClickModal,"close-on-press-escape":o.closeOnPressEscape,"show-close":o.showClose},{footer:r(()=>[D("div",null,[w(e.$slots,"footer")])]),default:r(()=>[w(e.$slots,"body")]),_:3},8,["width","title","modelValue","onClosed","close-on-click-modal","close-on-press-escape","show-close"])}const O=b(B,[["render",P]]),E={components:{Dialog:O},data(){return{submit_loading:!1,visible:!1,form:{}}},methods:{edit:function(e){this.form={...e},this.visible=!0},async submit(){const{valid:e}=await this.$refs.form.validate();e&&(this.submit_loading=!0,this.$request.execute({method:this.form.id?"put":"post",url:this.form.id?p.system.role.update:p.system.role.create,data:this.form,json:!0}).then(()=>{this.visible=!1,this.$emit("submited")}).finally(()=>{this.submit_loading=!1}))}},watch:{visible(e){e||this.$refs.form.reset()}}};function N(e,t,o,_,s,a){const f=i("v-btn"),c=i("v-text-field"),d=i("v-card-text"),h=i("v-spacer"),u=i("v-btn-text"),n=i("v-card-actions"),C=i("v-card"),S=i("v-form"),q=i("v-dialog");return v(),x(q,{modelValue:s.visible,"onUpdate:modelValue":t[4]||(t[4]=m=>s.visible=m),"max-width":"350"},{activator:r(({props:m})=>[l(f,R({color:"blue-lighten-1",text:"新增角色"},m),null,16)]),default:r(()=>[l(S,{onSubmit:t[3]||(t[3]=V(()=>{},["prevent"])),ref:"form"},{default:r(()=>[l(C,null,{default:r(()=>[l(d,null,{default:r(()=>[l(c,{rules:[e.$validator.required],label:"角色名称",modelValue:s.form.name,"onUpdate:modelValue":t[0]||(t[0]=m=>s.form.name=m)},null,8,["rules","modelValue"]),l(c,{rules:[e.$validator.required,e.$validator.integer],label:"排序号",modelValue:s.form.sort,"onUpdate:modelValue":t[1]||(t[1]=m=>s.form.sort=m)},null,8,["rules","modelValue"])]),_:1}),l(n,null,{default:r(()=>[l(h),l(u,{text:"Close",onClick:t[2]||(t[2]=m=>s.visible=!1)}),l(u,{disabled:s.submit_loading,loading:s.submit_loading,color:"primary",text:"Save",onClick:a.submit},null,8,["disabled","loading","onClick"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}const j=b(E,[["render",N]]),z={data(){return{role_id:"",visible:!1,menus:[],selected:[]}},methods:{init(){const e=new Promise((o,_)=>{this.$request.get({url:p.system.menu.tree}).then(s=>{o(s)})}).then(o=>{this.menus=o}),t=new Promise((o,_)=>{this.$request.get({url:p.system.role.authorization_ids,params:{roleId:this.role_id}}).then(s=>{o(s)})}).then(o=>{this.selected=o});Promise.all([e,t]).finally(()=>{})},show:function(e){this.role_id=e,this.visible=!0,this.$nextTick(()=>{this.init()})},isSelected(e){return this.selected.map(o=>o.id).indexOf(e)!=-1},toggleSelect(e){let o=this.selected.map(_=>_.id).indexOf(e.id);o===-1?this.selected.push({id:e.id,type:e.classify}):this.selected.splice(o,1)},save:function(){this.$request.post({url:p.system.role.update_authorization,data:{roleId:this.role_id,authorization:this.selected},json:!0}).then(()=>{this.$message.success("保存成功")})}}};function I(e,t,o,_,s,a){const f=i("v-checkbox"),c=i("v-treeview"),d=i("v-btn-text"),h=i("v-card"),u=i("v-dialog");return v(),x(u,{modelValue:s.visible,"onUpdate:modelValue":t[3]||(t[3]=n=>s.visible=n),width:"600",scrollable:""},{default:r(()=>[l(h,null,{actions:r(()=>[l(d,{onClick:t[1]||(t[1]=n=>s.visible=!1),text:"关闭"}),l(d,{color:"primary",onClick:t[2]||(t[2]=n=>a.save()),text:"确定"})]),default:r(()=>[l(c,{density:"compact",items:s.menus,"active-strategy":"classic"},{prepend:r(({item:n})=>[l(f,{density:"compact",onClick:t[0]||(t[0]=V(()=>{},["stop"])),ripple:!1,"onUpdate:modelValue":C=>a.toggleSelect(n),"model-value":a.isSelected(n.id),"hide-details":!0},null,8,["onUpdate:modelValue","model-value"])]),title:r(({item:n})=>[g(M(n.title||n.name)+" ",1),n.classify==="PAGE"?(v(),y(k,{key:0},[g("[页面]")],64)):$("",!0),n.classify==="PERMISSION"?(v(),y(k,{key:1},[g("[权限]")],64)):$("",!0)]),_:1},8,["items"])]),_:1})]),_:1},8,["modelValue"])}const A=b(z,[["render",I]]),F={components:{RoleDialog:j,UserMenusDialog:A},data(){return{tableHeaders:[{title:"排序号",key:"sort",width:90,sortable:!1},{title:"角色",key:"name",sortable:!1},{title:"用户数",key:"userCount",width:100,align:"center",sortable:!1},{key:"actions",width:400,align:"center",sortable:!1}],roles:[]}},beforeMount(){this.$store.commit("update_sider_active","/system/roles")},mounted(){this.requestRoles()},methods:{requestRoles:function(){this.$request.get({url:p.system.role.all,loading:!0}).then(e=>{this.roles=e})},del:function(e){this.$confirm({message:"是否要删除？"}).then(()=>{this.$request.delete({url:p.system.role.delete,data:{id:e}}).then(()=>{this.requestRoles()})}).catch(()=>{})}}};function G(e,t,o,_,s,a){const f=i("RoleDialog"),c=i("UserMenusDialog"),d=i("v-btn-link"),h=i("v-data-table-virtual");return v(),y(k,null,[l(f,{ref:"RoleDialog",onSubmited:a.requestRoles},null,8,["onSubmited"]),l(c,{ref:"UserMenusDialog"},null,512),l(h,{headers:s.tableHeaders,items:s.roles},{"item.actions":r(({item:u})=>[l(d,{text:"编辑",onClick:n=>e.$refs.RoleDialog.edit(u)},null,8,["onClick"]),l(d,{onClick:()=>{e.$router.push({path:"/system/role/users",query:{id:u.id}})},text:"用户管理"},null,8,["onClick"]),l(d,{onClick:n=>e.$refs.UserMenusDialog.show(u.id),text:"菜单管理"},null,8,["onClick"]),l(d,{onClick:n=>a.del(u.id),text:"删除"},null,8,["onClick"])]),_:1},8,["headers","items"])],64)}const J=b(F,[["render",G]]);export{J as default};
