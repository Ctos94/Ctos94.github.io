import{_ as C,r as s,o as i,c,h as k,F as b,n as N,z as D,l as V,e as v,f as T,t as x,B as U,w as n,b as l,A as g,v as O,a as M}from"./index-d815b49d.js";import{_ as P}from"./TreeSelect-55fdbfe6.js";const j={name:"TreeTableItem",props:{columns:{type:Array},item:{type:Object},loop:{type:Number,default:0}},computed:{columns_(){return this.columns.filter(t=>t.key)}},data(){return{expand:!1}}},J={key:2,style:"margin-left: 21px"};function z(t,e,r,w,o,_){const y=s("v-icon"),f=s("TreeTableItem",!0);return i(),c(b,null,[k("tr",null,[(i(!0),c(b,null,N(_.columns_,(a,d)=>(i(),c("td",{key:d,style:D({textAlign:a.align})},[d==0?(i(),c(b,{key:0},[r.loop&&r.loop>0?(i(),c("span",{key:0,style:D(`margin-left: ${15*r.loop}px`)},null,4)):V("",!0),r.item.children&&r.item.children.length>0?(i(),v(y,{key:1,onClick:e[0]||(e[0]=T(I=>o.expand=!o.expand,["stop"])),icon:o.expand?"mdi-menu-down":"mdi-menu-right"},null,8,["icon"])):(i(),c("span",J))],64)):V("",!0),k("span",null,x(a.render?a.render(r.item[a.key]):r.item[a.key]),1)],4))),128)),U(t.$slots,"default")]),r.item&&r.item.children&&r.item.children.length>0&&o.expand?(i(!0),c(b,{key:0},N(r.item.children,(a,d)=>(i(),v(f,{key:d,loop:r.loop+1,item:a,columns:r.columns},{default:n(()=>[U(t.$slots,"default")]),_:2},1032,["loop","item","columns"]))),128)):V("",!0)],64)}const E=C(j,[["render",z]]),W={components:{TreeTableItem:E},props:{loading:{type:Boolean,default:!1},headers:{type:Array,defalut:()=>[]},items:{type:Array,defalut:()=>[]}},data(){return{}},mounted(){},methods:{filter(t){return t.filter(e=>e.key)}}},F={key:0,class:"data-table-actions",style:{width:"200px"}},H=k("span",null,null,-1),G=[H];function Y(t,e,r,w,o,_){const y=E,f=s("v-data-table-virtual");return i(),c("div",null,[l(f,{loading:r.loading,headers:[...r.headers,{}],items:r.items},{headers:n(({headers:a})=>[k("tr",null,[(i(!0),c(b,null,N(_.filter(a[0]),d=>(i(),c("th",{key:d.key,style:D({width:`${d.width}px`})},[k("div",{class:"v-data-table-header__content",style:D({justifyContent:d.align})},[k("span",null,x(d.title),1)],4)],4))),128)),t.$slots["item.actions"]?(i(),c("th",F,G)):V("",!0)])]),item:n(({item:a,columns:d})=>[l(y,{item:a,columns:d},{default:n(()=>[t.$slots["item.actions"]?U(t.$slots,"item.actions",{key:0,item:a}):V("",!0)]),_:2},1032,["item","columns"])]),_:3},8,["loading","headers","items"])])}const $=C(W,[["render",Y]]);const K={components:{TreeSelect:P},props:{parents:{type:Array,default:function(){return[]}}},emits:["submited"],data(){return{visible:!1,submit_loading:!1,form:{}}},methods:{edit(t){this.form={...t},this.visible=!0},async submit(){const{valid:t}=await this.$refs.form.validate();t&&(this.submit_loading=!0,this.$request.execute({method:this.form.id?"put":"post",url:this.form.id?g.system.menu.update:g.system.menu.create,data:this.form,json:!0}).then(()=>{this.visible=!1,this.$emit("submited")}).finally(()=>{this.submit_loading=!1}))}},watch:{visible(t){t||this.$refs.form.reset()}}};function Q(t,e,r,w,o,_){const y=s("v-btn"),f=s("v-text-field"),a=s("v-col"),d=s("v-row"),I=s("v-select"),A=P,R=s("v-card-text"),S=s("v-spacer"),q=s("v-btn-text"),m=s("v-card-actions"),p=s("v-card"),h=s("v-form"),L=s("v-dialog");return i(),v(L,{modelValue:o.visible,"onUpdate:modelValue":e[9]||(e[9]=u=>o.visible=u),"max-width":"600"},{activator:n(({props:u})=>[l(y,O({color:"blue-lighten-1",text:"添加菜单"},u),null,16)]),default:n(()=>[l(h,{class:"form",onSubmit:e[8]||(e[8]=T(()=>{},["prevent"])),ref:"form"},{default:n(()=>[l(p,null,{default:n(()=>[l(R,null,{default:n(()=>[l(d,null,{default:n(()=>[l(a,null,{default:n(()=>[l(f,{label:"名称",rules:[t.$validator.required],modelValue:o.form.title,"onUpdate:modelValue":e[0]||(e[0]=u=>o.form.title=u)},null,8,["rules","modelValue"])]),_:1}),l(a,null,{default:n(()=>[l(f,{rules:[t.$validator.required,t.$validator.integer],label:"排序号",modelValue:o.form.sort,"onUpdate:modelValue":e[1]||(e[1]=u=>o.form.sort=u)},null,8,["rules","modelValue"])]),_:1})]),_:1}),l(d,null,{default:n(()=>[l(a,null,{default:n(()=>[l(I,{rules:[t.$validator.required],items:[{title:"菜单",value:"MENU"},{title:"页面",value:"PAGE"}],modelValue:o.form.type,"onUpdate:modelValue":e[2]||(e[2]=u=>o.form.type=u),label:"类型"},null,8,["rules","modelValue"])]),_:1}),l(a,null,{default:n(()=>[l(f,{label:"module",modelValue:o.form.module,"onUpdate:modelValue":e[3]||(e[3]=u=>o.form.module=u)},null,8,["modelValue"])]),_:1})]),_:1}),o.form.id?V("",!0):(i(),v(A,{key:0,itemTitle:"title",itemValue:"id",label:"上级菜单",items:r.parents,modelValue:o.form.parentId,"onUpdate:modelValue":e[4]||(e[4]=u=>o.form.parentId=u)},null,8,["items","modelValue"])),l(f,{label:"代码",modelValue:o.form.code,"onUpdate:modelValue":e[5]||(e[5]=u=>o.form.code=u)},null,8,["modelValue"]),l(f,{label:"路径",modelValue:o.form.path,"onUpdate:modelValue":e[6]||(e[6]=u=>o.form.path=u)},null,8,["modelValue"])]),_:1}),l(m,null,{default:n(()=>[l(S),l(q,{text:"Close",onClick:e[7]||(e[7]=u=>o.visible=!1)}),l(q,{disabled:o.submit_loading,loading:o.submit_loading,color:"primary",text:"Save",onClick:_.submit},null,8,["disabled","loading","onClick"])]),_:1})]),_:1})]),_:1},512)]),_:1},8,["modelValue"])}const X=C(K,[["render",Q],["__scopeId","data-v-2fa6bb1d"]]),B={id:null,name:null,code:null},Z={rowType:"modify"},ee={rowType:"add"},te={data(){return{headers:[{key:"name",width:"200",title:"名称",sortable:!1},{key:"code",title:"代码",sortable:!1},{key:"actions",width:"160",sortable:!1}],menuId:null,visible:!1,showAddRow:!0,modifyRowIdx:-1,dataList:[],formData:{modify:null,add:JSON.parse(JSON.stringify(B))},authorityCodes:[]}},computed:{dataListView(){let t=[...this.dataList];return this.showAddRow&&t.push(ee),this.modifyRowIdx!==-1&&(t[this.modifyRowIdx]=Z),t}},methods:{show(t){this.menuId=t,this.visible=!0,this.$nextTick(()=>{this.requestAuthorityCodes(),this.requestPermissions()})},async requestAuthorityCodes(){await this.$request.get({url:g.system.permission.codes}).then(t=>{this.authorityCodes=Object.keys(t).map(e=>({code:e,label:t[e]}))})},async requestPermissions(){await this.$request.get({url:g.system.menu.permissions,params:{menuId:this.menuId}}).then(t=>{this.dataList=t})},resetAddRow(){this.formData.add=JSON.parse(JSON.stringify(B))},async tableBtnClick(t,e,r){switch(t){case"add":var{valid:w}=await this.$refs.form.validate();if(!w)return;Object.assign(this.formData.add,{menuId:this.menuId}),this.$request.post({url:g.system.permission.create,data:this.formData.add,json:!0}).then(()=>{this.resetAddRow(),this.requestPermissions()});break;case"modify":this.modifyRowIdx!==-1?this.$message.error("请先完成修改的行"):(this.showAddRow=!1,this.formData.modify=JSON.parse(JSON.stringify(e)),this.modifyRowIdx=r);break;case"update":var{valid:w}=await this.$refs.form.validate();if(!w)return;this.$request.put({url:g.system.permission.update,data:{id:this.formData.modify.id,name:this.formData.modify.name,code:this.formData.modify.code},json:!0}).then(()=>{this.requestPermissions(),this.showAddRow=!0,this.formData.modify=null,this.modifyRowIdx=-1});break;case"cancel":this.showAddRow=!0,this.formData.modify=null,this.modifyRowIdx=-1;break;case"delete":this.$confirm({message:"是否删除？"}).then(()=>{this.$request.delete({url:g.system.permission.delete,data:{id:e.id}}).then(()=>{this.requestPermissions()})}).catch(()=>{});break}}},watch:{visible(t){t||this.$refs.form.reset()}}},oe={style:{float:"left"}},le={class:"code-select-span"};function se(t,e,r,w,o,_){const y=s("v-text-field"),f=s("v-list-item"),a=s("v-select"),d=s("v-btn-link"),I=s("v-data-table-virtual"),A=s("v-form"),R=s("v-card-text"),S=s("v-card"),q=s("v-dialog");return i(),v(q,{modelValue:o.visible,"onUpdate:modelValue":e[4]||(e[4]=m=>o.visible=m),"max-width":"620"},{default:n(()=>[l(S,null,{default:n(()=>[l(R,null,{default:n(()=>[l(A,{ref:"form",onSubmit:e[3]||(e[3]=T(()=>{},["prevent"]))},{default:n(()=>[l(I,{headers:o.headers,items:_.dataListView},{"item.name":n(({item:m})=>[m.rowType?(i(),v(y,{key:0,"validate-on":"submit",modelValue:o.formData[m.rowType].name,"onUpdate:modelValue":p=>o.formData[m.rowType].name=p,rules:[t.$validator.required]},null,8,["modelValue","onUpdate:modelValue","rules"])):(i(),c(b,{key:1},[M(x(m.name),1)],64))]),"item.code":n(({item:m})=>[m.rowType?(i(),v(a,{key:0,clearable:"","validate-on":"submit",rules:[t.$validator.required],items:o.authorityCodes,"item-title":"code","item-value":"code",modelValue:o.formData[m.rowType].code,"onUpdate:modelValue":p=>o.formData[m.rowType].code=p},{item:n(({props:p,item:h})=>[l(f,O({ripple:!1},p),{title:n(()=>[k("span",oe,x(h.raw.code),1),k("span",le,x(h.raw.label),1)]),_:2},1040)]),_:2},1032,["rules","items","modelValue","onUpdate:modelValue"])):(i(),c(b,{key:1},[M(x(m.code),1)],64))]),"item.actions":n(({item:m,index:p})=>[m.rowType==="add"?(i(),v(d,{key:0,type:"success",onClick:e[0]||(e[0]=h=>_.tableBtnClick("add")),text:"添加"})):m.rowType==="modify"?(i(),c(b,{key:1},[l(d,{onClick:e[1]||(e[1]=h=>_.tableBtnClick("update")),text:"保存"}),l(d,{onClick:e[2]||(e[2]=h=>_.tableBtnClick("cancel")),text:"取消"})],64)):(i(),c(b,{key:2},[l(d,{onClick:T(h=>_.tableBtnClick("modify",m,p),["stop"]),text:"修改"},null,8,["onClick"]),this.modifyRowIdx===-1?(i(),v(d,{key:0,size:"small",icon:"mdi-delete",onClick:T(h=>_.tableBtnClick("delete",m,p),["stop"])},null,8,["onClick"])):V("",!0)],64))]),_:1},8,["headers","items"])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"])}const ne=C(te,[["render",se]]),ie={components:{MenuDialog:X,MenuPermissionDialog:ne,TreeTable:$},data(){return{loading:!1,tableHeaders:[{title:"标题",key:"title",width:180},{title:"module",key:"module",width:180},{title:"类型",key:"type",width:150,align:"center"},{title:"路径",key:"path"},{title:"代码",key:"code",width:300}],menus:[]}},computed:{},beforeMount(){this.$store.commit("update_sider_active","/system/menu")},beforeMount(){this.$store.commit("update_sider_active","/system/menus")},mounted(){this.request()},methods:{request(){this.loading=!0,this.$request.get({url:g.system.menu.list}).then(t=>{this.menus=t}).finally(()=>{this.loading=!1})}}},re={width:"200"};function ae(t,e,r,w,o,_){const y=s("MenuDialog"),f=s("v-btn-link"),a=$;return i(),c("div",null,[l(y,{onSubmited:this.request,parents:o.menus},null,8,["onSubmited","parents"]),l(a,{headers:o.tableHeaders,items:o.menus,loading:o.loading},{"item.actions":n(({item:d})=>[k("td",re,[l(f,{text:"编辑"}),l(f,{text:"权限管理"})])]),_:1},8,["headers","items","loading"])])}const ue=C(ie,[["render",ae]]);export{ue as default};
