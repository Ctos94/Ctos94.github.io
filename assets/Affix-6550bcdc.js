import{_ as e,o as s,c as i,a as t,N as a,s as l,J as r,T as o,u as d,A as u,h as c,w as n,F as f,U as h,V as p,r as m,W as g,X as _,b as x,y,e as A,x as I,B as k,Y as w,Z as v}from"./index-273db4d9.js";/* empty css                   *//* empty css                  *//* empty css               */import{_ as V}from"./Uploader-d4fe81d9.js";const b={key:0,class:"mask"};const S=e({props:{src:{type:String},height:{type:String,default:"100%"}},computed:{showMask(){return this.$slots.mask}}},[["render",function(e,d,u,c,n,f){const h=o;return s(),i("div",{class:"container",style:r({height:u.height})},[t(h,{src:u.src},null,8,["src"]),f.showMask?(s(),i("div",b,[a(e.$slots,"mask",{},void 0,!0)])):l("",!0)],4)}],["__scopeId","data-v-7ddf7ef8"]]),q={class:"header"},L=["onClick"],U={key:0,class:"picture-box"},$={class:"picture-dialog"},j={class:"picture-box"},F={class:"btn"};const C=e({setup(){d().commit("update_sider_openeds","DIABLO4_SOURCE_AFFIXES")},components:{Uploader:V},data:()=>({uploaded_count:0,queryArgs:{keyword:"",notHasImages:void 0},showImage:!1,upload_url:u.diablo4.source.import_data,upload_file_url:u.file.upload,affixList:[],filterAffixList:[],picVisible:!1,picList:[],current_affix:void 0}),computed:{dialogTitle:function(){return null!=this.current_affix?this.current_affix.description:""}},mounted(){this.fetchAffixes()},methods:{fetchAffixes(){this.$request.get({url:u.diablo4.source.affixes,params:{showImage:this.showImage}}).then((e=>{this.affixList=e,this.$nextTick((()=>{this.filterAffix()}))}))},filterAffix(){this.filterAffixList=this.affixList.filter((e=>{let s=!0,i=!0;return this.queryArgs.keyword&&(s=e.description.includes(this.queryArgs.keyword)),this.queryArgs.notHasImages&&(i=!e.hasImages),s&&i}))},showPicDialog(e){this.picVisible=!0,this.current_affix=e,this.fetchAffixImages()},fetchAffixImages(){this.$request.get({url:u.diablo4.source.affix_images,params:{idSno:this.current_affix.idSno}}).then((e=>{this.picList=e,null!=this.current_affix&&(this.current_affix.hasImages=this.picList.length>0,this.showImage&&(this.current_affix.images=this.picList))}))},saveAffixImages(e,s,i){if(this.uploaded_count++,this.uploaded_count==i.length){let e=[];i.forEach((s=>{e.push(s.response.data.id)})),this.$request.post({url:u.diablo4.source.save_affix_images,data:{idSno:this.current_affix.idSno,fileIds:e.join(",")}}).then((()=>{this.uploaded_count=0,this.$refs.uploader.clearFiles(),this.fetchAffixImages()}))}},delPic(e){this.$request.delete({loading:{fullscreen:!0,lock:!0},url:u.diablo4.source.del_affix_image,data:{id:e}}).then((()=>{this.fetchAffixImages()}))}},watch:{queryArgs:{handler:"filterAffix",deep:!0},showImage:{handler:"fetchAffixes"}}},[["render",function(e,a,r,o,d,u){const b=h,C=p,O=V,T=m("WarnTriangleFilled"),D=k,E=S,H=w,P=g,R=m("Delete"),B=v,X=_;return s(),i(f,null,[c("div",q,[t(b,{clearable:"",style:{width:"300px",height:"32px",marginRight:"12px"},modelValue:d.queryArgs.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>d.queryArgs.keyword=e),placeholder:"词缀"},null,8,["modelValue"]),t(C,{modelValue:d.queryArgs.notHasImages,"onUpdate:modelValue":a[1]||(a[1]=e=>d.queryArgs.notHasImages=e),style:{marginRight:"12px"}},{default:n((()=>[x("未关联图像")])),_:1},8,["modelValue"]),t(C,{modelValue:d.showImage,"onUpdate:modelValue":a[2]||(a[2]=e=>d.showImage=e),style:{marginRight:"12px"}},{default:n((()=>[x("显示图像")])),_:1},8,["modelValue"]),t(O,{upload_url:d.upload_url,accept:".json",data:{type:"AFFIXES"},onOnSuccess:u.fetchAffixes},null,8,["upload_url","onOnSuccess"])]),t(P,{gutter:20},{default:n((()=>[(s(!0),i(f,null,y(d.filterAffixList,(e=>(s(),A(H,{key:e.idSno,span:8,class:"pointer",style:{marginBottom:"8px"}},{default:n((()=>[c("div",{class:"grid-content",onClick:s=>u.showPicDialog(e)},[e.hasImages?l("",!0):(s(),A(D,{key:0,class:"text-red"},{default:n((()=>[t(T)])),_:1})),c("span",null,I(e.description),1)],8,L),this.showImage?(s(),i("div",U,[(s(!0),i(f,null,y(e.images,(e=>(s(),i("div",{class:"pic",key:e.id},[t(E,{height:"40px",src:e.fileUrl},null,8,["src"])])))),128))])):l("",!0)])),_:2},1024)))),128))])),_:1}),c("div",$,[t(X,{modelValue:d.picVisible,"onUpdate:modelValue":a[3]||(a[3]=e=>d.picVisible=e),"z-index":2,width:"500",onClosed:a[4]||(a[4]=e=>this.current_affix=void 0),title:u.dialogTitle},{default:n((()=>[c("div",j,[(s(!0),i(f,null,y(d.picList,(e=>(s(),i("div",{class:"pic",key:e.id},[t(E,{height:"40px",src:e.fileUrl},{mask:n((()=>[t(D,{onClick:s=>u.delPic(e.id),class:"mask-icon"},{default:n((()=>[t(R)])),_:2},1032,["onClick"])])),_:2},1032,["src"])])))),128))]),c("div",F,[t(O,{ref:"uploader",upload_url:d.upload_file_url,accept:"image/*",multiple:!0,onOnSuccess:u.saveAffixImages},{default:n((()=>[t(B,{type:"primary"},{default:n((()=>[x("Upload")])),_:1})])),_:1},8,["upload_url","onOnSuccess"])])])),_:1},8,["modelValue","title"])])],64)}],["__scopeId","data-v-af8273b9"]]);export{C as default};
